<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="fantasykai`blog"><title>10种跨域解决方案 | 枫哲's文栖小筑</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + '2bb92548008bd1f1f88213efd40c8dad';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">🌓</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">10种跨域解决方案</h1><a id="logo" href="/.">枫哲's文栖小筑</a><p class="description">君子终日乾乾，夕惕若厉，无咎</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/timeline/"><i class="fa fa-book"> 历史</i></a><a href="/blogroll/"><i class="fa fa-external-link"> 收藏链接</i></a><a href="/2048/"><i class="fa fa-gamepad"> 放松下</i></a><a href="/guestbook/"><i class="fa fa-comments"> 留言</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">10种跨域解决方案</h1><div class="post-meta">2020-04-14<span> | </span><span class="category"><a href="/categories/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/">技术小栈</a></span></div><a class="disqus-comment-count" href="/2020/04/14/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/10%E7%A7%8D%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/#vcomment"><span class="waline-comment-count" id="/2020/04/14/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/10%E7%A7%8D%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"></span><span> 条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text">写在前面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%B7%A8%E5%9F%9F%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">一、跨域是什么？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5"><span class="toc-number">2.1.</span> <span class="toc-text">1.同源策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%90%8C%E6%BA%90%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.2.</span> <span class="toc-text">2.同源示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">二、如何解决跨域？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-CORS"><span class="toc-number">3.1.</span> <span class="toc-text">1.CORS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82"><span class="toc-number">3.1.1.</span> <span class="toc-text">a.简单请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-%E9%9D%9E%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82"><span class="toc-number">3.1.2.</span> <span class="toc-text">b.非简单请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-Node-%E4%B8%AD%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">3.1.3.</span> <span class="toc-text">c.Node 中的解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E6%96%B9%E5%BC%8F"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">原生方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">第三方中间件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-cors-%E7%9A%84-cookie-%E9%97%AE%E9%A2%98"><span class="toc-number">3.1.3.3.</span> <span class="toc-text">关于 cors 的 cookie 问题</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-%E5%89%8D%E7%AB%AF%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.1.4.</span> <span class="toc-text">d.前端示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">简单请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%9E%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82"><span class="toc-number">3.1.4.2.</span> <span class="toc-text">非简单请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">3.1.4.3.</span> <span class="toc-text">小结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Node-%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">2.Node 正向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-cli-%E5%B7%A5%E5%85%B7%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%90%86"><span class="toc-number">3.2.1.</span> <span class="toc-text">a.cli 工具中的代理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Webpack-4-x"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">1) Webpack (4.x)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Vue-cli-2-x"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">2) Vue-cli 2.x</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-Vue-cli-3-x"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">3) Vue-cli 3.x</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-Parcel-2-x"><span class="toc-number">3.2.1.4.</span> <span class="toc-text">4) Parcel (2.x)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">3.2.2.</span> <span class="toc-text">b.使用自己的代理工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-charles"><span class="toc-number">3.2.3.</span> <span class="toc-text">c.charles</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">前端代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">3.2.3.3.</span> <span class="toc-text">后端代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%88%E6%9E%9C"><span class="toc-number">3.2.3.4.</span> <span class="toc-text">效果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Nginx-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">3.3.</span> <span class="toc-text">3.Nginx 反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">3.3.0.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.0.2.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%88%E6%9E%9C-1"><span class="toc-number">3.3.0.3.</span> <span class="toc-text">效果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-JSONP"><span class="toc-number">3.4.</span> <span class="toc-text">4.JSONP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Websocket"><span class="toc-number">3.5.</span> <span class="toc-text">5.Websocket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-window-postMessage"><span class="toc-number">3.6.</span> <span class="toc-text">6.window.postMessage</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E9%80%94"><span class="toc-number">3.6.1.</span> <span class="toc-text">用途</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%B3%95"><span class="toc-number">3.6.2.</span> <span class="toc-text">用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.6.3.</span> <span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-document-domain-Iframe"><span class="toc-number">3.7.</span> <span class="toc-text">7.document.domain + Iframe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-window-location-hash-Iframe"><span class="toc-number">3.8.</span> <span class="toc-text">8.window.location.hash + Iframe</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">3.8.1.</span> <span class="toc-text">实现原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B"><span class="toc-number">3.8.2.</span> <span class="toc-text">实现流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-window-name-Iframe"><span class="toc-number">3.9.</span> <span class="toc-text">9.window.name + Iframe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%BC%80%E5%90%AF%E8%B7%A8%E5%9F%9F%EF%BC%88%E7%BB%88%E6%9E%81%E6%96%B9%E6%A1%88%EF%BC%89"><span class="toc-number">3.10.</span> <span class="toc-text">10.浏览器开启跨域（终极方案）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows"><span class="toc-number">3.10.1.</span> <span class="toc-text">Windows</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mac"><span class="toc-number">3.10.2.</span> <span class="toc-text">Mac</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="toc-number">3.10.3.</span> <span class="toc-text">效果展示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E8%B7%A8%E5%9F%9F%EF%BC%9F"><span class="toc-number">4.</span> <span class="toc-text">三、为什么需要跨域？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%99%90%E5%88%B6%E4%B8%8D%E5%90%8C%E6%BA%90%E7%9A%84%E8%AF%B7%E6%B1%82"><span class="toc-number">4.1.</span> <span class="toc-text">1.限制不同源的请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%99%90%E5%88%B6-dom-%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">2.限制 dom 操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E"><span class="toc-number">5.</span> <span class="toc-text">写在最后</span></a></li></ol></div></div><div class="post-content"><p>10种跨域解决方案</p>
<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>嗯。又来了，又说到跨域了，这是一个老生常谈的话题，以前我觉得这种基础文章没有什么好写的，会想着你去了解底层啊，不是很简单吗。但是最近在开发一个 <strong>「vscode 插件」</strong> 发现，当你刚入门一样东西的时候，你不会想这么多，因为你对他不熟悉，当你遇到不会的东西，你就是想先找到解决方案，然后通过这个解决方案再去深入理解。就比如跨域，新人或者刚接触的人对它并不是那么熟悉，所以说列出一些自己积累的方案，以及一些常用的场景来给他人带来一些解决问题的思路，这件事是有意义的。（写完之后还发现真香。以后忘了还能回来看看）</p>
<p>其实现在的环境对于刚入门的前端来说，非常的不友好，一方面吧，很多刚新人没有经历过工具的变更时代，另一方面框架的迭代更新速度很快。在以前你可能掌握几种常见的手法就好了。但是现在 <code>webpack-dev-server</code>、<code>vue-cli</code>、<code>parcel</code>，这些脚手架都进行了一层封装，对于熟悉的人可能很简单，但是对于还未入门的人来说，简直就是一个黑盒，虽然用起来很方便，但是某一天遇到了问题，你对它不熟悉，你就会不知道所错。（但是别慌，主流 cli 的跨域方式我都会讲到）</p>
<p>讲着讲着有点偏离方向，可能我讲的也并不一定是正确的。下面切入正题。</p>
<p>本文会以 <strong>「「What-How-Why」」</strong> 的方式来进行讲解。而在在 How （如何解决跨域，将会提供标题的 11 种方案。）</p>
<p><strong>「重要的说明: 在文中，web 端地址为 localhost:8000 服务端地址为 localhost:8080,这一点希望你能记住，会贯穿全文，你也可以把此处的两端的地址代入你自己的地址。」</strong></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441c4fcc8371~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="cors">cors</p>
<p>以下所有代码均在 <a href="https://link.juejin.cn/?target=https://github.com/hua1995116/node-demo/tree/master/node-cors">github.com&#x2F;hua1995116&#x2F;…</a></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441c535d5dbe~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200413192431636">image-20200413192431636</p>
<h2 id="一、跨域是什么？"><a href="#一、跨域是什么？" class="headerlink" title="一、跨域是什么？"></a>一、跨域是什么？</h2><h3 id="1-同源策略"><a href="#1-同源策略" class="headerlink" title="1.同源策略"></a>1.同源策略</h3><p>跨域问题其实就是浏览器的同源策略所导致的。</p>
<blockquote>
<p>❝</p>
<p><strong>「同源策略」</strong>是一个重要的安全策略，它用于限制一个<a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Glossary/%E6%BA%90">origin</a>的文档或者它加载的脚本如何能与另一个源的资源进行交互。它能帮助阻隔恶意文档，减少可能被攻击的媒介。</p>
<p>–来源 MDN</p>
<p>❞</p>
</blockquote>
<p>当跨域时会收到以下错误</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441c54607698~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200413205559124">image-20200413205559124</p>
<h3 id="2-同源示例"><a href="#2-同源示例" class="headerlink" title="2.同源示例"></a>2.同源示例</h3><p>那么如何才算是同源呢？先来看看 url 的组成部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.example.com:80/path/to/myfile.html?key1=value1&amp;key2=value2#SomewhereInTheDocument</span><br></pre></td></tr></table></figure>

<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441c9498fb98~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412171942421">image-20200412171942421</p>
<p>只有当</p>
<p><strong>「protocol（协议）、domain（域名）、port（端口）三者一致。」</strong></p>
<p><strong>「protocol（协议）、domain（域名）、port（端口）三者一致。」</strong></p>
<p><strong>「protocol（协议）、domain（域名）、port（端口）三者一致。」</strong></p>
<p>才是同源。</p>
<p>以下协议、域名、端口一致。</p>
<p><a target="_blank" rel="noopener" href="http://www.example.com/a.js">http://www.example.com:80/a.js</a></p>
<p><a target="_blank" rel="noopener" href="http://www.example.com/b.js">http://www.example.com:80/b.js</a></p>
<p>以下这种看上去再相似也没有用，都不是同源。</p>
<p><a target="_blank" rel="noopener" href="http://www.example.com:8080/">http://www.example.com:8080</a></p>
<p><a target="_blank" rel="noopener" href="http://www2.example.com/">http://www2.example.com:80</a></p>
<p>在这里注意一下啊，这里是为了突出端口的区别才写上端口。在默认情况下 http 可以省略端口 80， https 省略 443。这别到时候闹笑话了，你和我说 <a target="_blank" rel="noopener" href="http://www.example.com/">http://www.example.com:80</a> 和 <a target="_blank" rel="noopener" href="http://www.example.com/">http://www.example.com</a> 不是同源，他俩是一个东西。</p>
<p><a target="_blank" rel="noopener" href="http://www.example.com/">http://www.example.com:80</a> &#x3D;&#x3D;&#x3D; <a target="_blank" rel="noopener" href="http://www.example.com/">http://www.example.com</a></p>
<p><a target="_blank" rel="noopener" href="https://www.example.com/">https://www.example.com:443</a> &#x3D;&#x3D;&#x3D; <a target="_blank" rel="noopener" href="https://www.example.com/">https://www.example.com</a></p>
<p>唔，还是要说明一下。</p>
<h2 id="二、如何解决跨域？"><a href="#二、如何解决跨域？" class="headerlink" title="二、如何解决跨域？"></a>二、如何解决跨域？</h2><h3 id="1-CORS"><a href="#1-CORS" class="headerlink" title="1.CORS"></a>1.CORS</h3><p>跨域资源共享(<a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Glossary/CORS">CORS</a>) 是一种机制，它使用额外的 <a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Glossary/HTTP">HTTP</a> 头来告诉浏览器 让运行在一个 origin (domain) 上的 Web 应用被准许访问来自不同源服务器上的指定的资源。当一个资源从与该资源本身所在的服务器<strong>「不同的域、协议或端口」</strong>请求一个资源时，资源会发起一个<strong>「跨域 HTTP 请求」</strong>。</p>
<p>而在 cors 中会有 <code>简单请求</code> 和 <code>复杂请求</code>的概念。</p>
<p><strong>「浏览器支持情况」</strong></p>
<p>当你使用 IE&lt;&#x3D;9, Opera&lt;12, or Firefox&lt;3.5 或者更加老的浏览器，这个时候请使用 JSONP 。</p>
<h4 id="a-简单请求"><a href="#a-简单请求" class="headerlink" title="a.简单请求"></a>a.简单请求</h4><p>不会触发 <a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS%23Preflighted_requests">CORS 预检请求</a>。这样的请求为“简单请求”，请注意，该术语并不属于 <a href="https://link.juejin.cn/?target=https://fetch.spec.whatwg.org/">Fetch</a> （其中定义了 CORS）规范。若请求满足所有下述条件，则该请求可视为“简单请求”：</p>
<p>情况一: 使用以下方法(意思就是以下请求以外的都是非简单请求)</p>
<ul>
<li><a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET"><code>GET</code></a></li>
<li><a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/HEAD"><code>HEAD</code></a></li>
<li><a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a></li>
</ul>
<p>情况二: 人为设置以下集合外的请求头</p>
<ul>
<li><a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept"><code>Accept</code></a></li>
<li><a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Language"><code>Accept-Language</code></a></li>
<li><a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Language"><code>Content-Language</code></a></li>
<li><a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type"><code>Content-Type</code></a> （需要注意额外的限制）</li>
<li><code>DPR</code></li>
<li><code>Downlink</code></li>
<li><code>Save-Data</code></li>
<li><code>Viewport-Width</code></li>
<li><code>Width</code></li>
</ul>
<p>情况三：<code>Content-Type</code>的值仅限于下列三者之一：(例如 application&#x2F;json 为非简单请求)</p>
<ul>
<li><code>text/plain</code></li>
<li><code>multipart/form-data</code></li>
<li><code>application/x-www-form-urlencoded</code></li>
</ul>
<p>情况四:</p>
<p>请求中的任意<a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequestUpload"><code>XMLHttpRequestUpload</code></a> 对象均没有注册任何事件监听器；<a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequestUpload"><code>XMLHttpRequestUpload</code></a> 对象可以使用 <a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/upload"><code>XMLHttpRequest.upload</code></a> 属性访问。</p>
<p>情况五:</p>
<p>请求中没有使用 <a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/API/ReadableStream"><code>ReadableStream</code></a> 对象。</p>
<h4 id="b-非简单请求"><a href="#b-非简单请求" class="headerlink" title="b.非简单请求"></a>b.非简单请求</h4><p>除以上情况外的。</p>
<h4 id="c-Node-中的解决方案"><a href="#c-Node-中的解决方案" class="headerlink" title="c.Node 中的解决方案"></a>c.Node 中的解决方案</h4><h5 id="原生方式"><a href="#原生方式" class="headerlink" title="原生方式"></a>原生方式</h5><p>我们来看下后端部分的解决方案。<code>Node</code> 中 <code>CORS</code> 的解决代码.</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="keyword">async</span> (ctx, <span class="keyword">next</span>) =&gt; &#123;</span><br><span class="line">  ctx.<span class="keyword">set</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, ctx.headers.origin);</span><br><span class="line">  ctx.<span class="keyword">set</span>(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">  ctx.<span class="keyword">set</span>(<span class="string">&quot;Access-Control-Request-Method&quot;</span>, <span class="string">&quot;PUT,POST,GET,DELETE,OPTIONS&quot;</span>);</span><br><span class="line">  ctx.<span class="keyword">set</span>(</span><br><span class="line">    <span class="string">&quot;Access-Control-Allow-Headers&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Origin, X-Requested-With, Content-Type, Accept, cc&quot;</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">if</span> (ctx.method === <span class="string">&quot;OPTIONS&quot;</span>) &#123;</span><br><span class="line">    ctx.status = <span class="number">204</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">await</span> <span class="keyword">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h5 id="第三方中间件"><a href="#第三方中间件" class="headerlink" title="第三方中间件"></a>第三方中间件</h5><p>为了方便也可以直接使用中间件</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const <span class="attr">cors</span> = require(<span class="string">&quot;koa-cors&quot;</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">app.use(cors())<span class="comment">;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h5 id="关于-cors-的-cookie-问题"><a href="#关于-cors-的-cookie-问题" class="headerlink" title="关于 cors 的 cookie 问题"></a>关于 cors 的 cookie 问题</h5><p>想要传递 <code>cookie</code> 需要满足 3 个条件</p>
<p>1.web 请求设置<code>withCredentials</code></p>
<p>这里默认情况下在跨域请求，浏览器是不带 cookie 的。但是我们可以通过设置 <code>withCredentials</code> 来进行传递 <code>cookie</code>.</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 原生 xml 的设置方式</span><br><span class="line">var <span class="attr">xhr</span> = new XMLHttpRequest()<span class="comment">;</span></span><br><span class="line"><span class="attr">xhr.withCredentials</span> = <span class="literal">true</span><span class="comment">;</span></span><br><span class="line">// axios 设置方式</span><br><span class="line"><span class="attr">axios.defaults.withCredentials</span> = <span class="literal">true</span><span class="comment">;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>2.<code>Access-Control-Allow-Credentials</code> 为 <code>true</code></p>
<p>3.<code>Access-Control-Allow-Origin</code>为非 <code>*</code></p>
<p>这里请求的方式，在 <code>chrome</code> 中是能看到返回值的，但是只要不满足以上其一，浏览器会报错，获取不到返回值。</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441c93623a0c~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412201424024">image-20200412201424024</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access to XMLHttpRequest at <span class="string">&#x27;http://127.0.0.1:8080/api/corslist&#x27;</span> <span class="keyword">from</span> origin <span class="string">&#x27;http://127.0.0.1:8000&#x27;</span> has been blocked <span class="keyword">by</span> CORS policy: The <span class="keyword">value</span> of the <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> header <span class="keyword">in</span> the response <span class="keyword">is</span> <span class="string">&#x27;&#x27;</span> which must be <span class="string">&#x27;true&#x27;</span> <span class="keyword">when</span> the request<span class="string">&#x27;s credentials mode is &#x27;</span>include<span class="string">&#x27;. The credentials mode of requests initiated by the XMLHttpRequest is controlled by the withCredentials attribute.</span></span><br><span class="line"><span class="string">复制代码</span></span><br></pre></td></tr></table></figure>

<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441c5d57082e~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412201411481">image-20200412201411481</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access to XMLHttpRequest at <span class="string">&#x27;http://127.0.0.1:8080/api/corslist&#x27;</span> <span class="keyword">from</span> origin <span class="string">&#x27;http://127.0.0.1:8000&#x27;</span> has been blocked <span class="keyword">by</span> CORS policy: The <span class="keyword">value</span> of the <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> header <span class="keyword">in</span> the response must <span class="keyword">not</span> be the wildcard <span class="string">&#x27;*&#x27;</span> <span class="keyword">when</span> the request<span class="string">&#x27;s credentials mode is &#x27;</span>include<span class="string">&#x27;. The credentials mode of requests initiated by the XMLHttpRequest is controlled by the withCredentials attribute.</span></span><br><span class="line"><span class="string">复制代码</span></span><br></pre></td></tr></table></figure>

<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441c4eaefff4~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412201530087">image-20200412201530087</p>
<h4 id="d-前端示例"><a href="#d-前端示例" class="headerlink" title="d.前端示例"></a>d.前端示例</h4><p>分别演示一下前端部分 <code>简单请求</code> 和 <code>非简单请求</code></p>
<h5 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/axios/0.19.2/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  axios.<span class="title function_">get</span>(<span class="string">&quot;http://127.0.0.1:8080/api/corslist&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h5 id="非简单请求"><a href="#非简单请求" class="headerlink" title="非简单请求"></a>非简单请求</h5><p>这里我们加入了一个非集合内的 <code>headers</code> 头 <code>cc</code> 来达到非简单请求的目的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/axios/0.19.2/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  axios.<span class="title function_">get</span>(<span class="string">&quot;http://127.0.0.1:8080/api/corslist&quot;</span>, &#123; <span class="attr">headers</span>: &#123; <span class="attr">cc</span>: <span class="string">&quot;xxx&quot;</span> &#125; &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441c5360c403~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412201158778">image-20200412201158778</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441c9140192e~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412195829232">image-20200412195829232</p>
<h5 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h5><p>1、 在新版的 chrome 中，如果你发送了复杂请求，你却看不到 <code>options</code> 请求。可以在这里设置 <code>chrome://flags/#out-of-blink-cors</code> 设置成 <code>disbale</code> ，重启浏览器。对于非简单请求就能看到 <code>options</code> 请求了。</p>
<p>2、 一般情况下后端接口是不会开启这个跨域头的，除非是一些与用户无关的不太重要的接口。</p>
<h3 id="2-Node-正向代理"><a href="#2-Node-正向代理" class="headerlink" title="2.Node 正向代理"></a>2.Node 正向代理</h3><p>代理的思路为，利用服务端请求不会跨域的特性，让接口和当前站点同域。</p>
<p><strong>「代理前」</strong></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441c9f004d9b~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412202320482">image-20200412202320482</p>
<p><strong>「代理后」</strong></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441cb6c9453f~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412202358759">image-20200412202358759</p>
<p>这样，所有的资源以及请求都在一个域名下了。</p>
<h4 id="a-cli-工具中的代理"><a href="#a-cli-工具中的代理" class="headerlink" title="a.cli 工具中的代理"></a>a.cli 工具中的代理</h4><h5 id="1-Webpack-4-x"><a href="#1-Webpack-4-x" class="headerlink" title="1) Webpack (4.x)"></a>1) Webpack (4.x)</h5><p>在<code>webpack</code>中可以配置<code>proxy</code>来快速获得接口代理的能力。</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const path = <span class="built_in">require</span>(&quot;path&quot;);</span><br><span class="line">const HtmlWebpackPlugin = <span class="built_in">require</span>(&quot;html-webpack-plugin&quot;);</span><br><span class="line"></span><br><span class="line">module<span class="selector-class">.exports</span> = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">&quot;./index.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">    path: path.<span class="built_in">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">8000</span>,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      &quot;/api&quot;: &#123;</span><br><span class="line">        target: <span class="string">&quot;http://localhost:8080&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new <span class="built_in">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      filename: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">      template: <span class="string">&quot;webpack.html&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>修改前端接口请求方式，改为不带域名。（因为现在是同域请求了）</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;button <span class="attr">id</span>=<span class="string">&quot;getlist&quot;</span>&gt;获取列表&lt;/button&gt;</span><br><span class="line">&lt;button <span class="attr">id</span>=<span class="string">&quot;login&quot;</span>&gt;登录&lt;/button&gt;</span><br><span class="line">&lt;script <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/axios/0.19.2/axios.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="attr">axios.defaults.withCredentials</span> = <span class="literal">true</span><span class="comment">;</span></span><br><span class="line">  <span class="attr">getlist.onclick</span> = () =&gt; &#123;</span><br><span class="line">    axios.get(&quot;/api/corslist&quot;).then(<span class="attr">res</span> =&gt; &#123;</span><br><span class="line">      console.log(res.data)<span class="comment">;</span></span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">  <span class="attr">login.onclick</span> = () =&gt; &#123;</span><br><span class="line">    axios.post(&quot;/api/login&quot;)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h5 id="2-Vue-cli-2-x"><a href="#2-Vue-cli-2-x" class="headerlink" title="2) Vue-cli 2.x"></a>2) Vue-cli 2.x</h5><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/index.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">proxyTable: &#123;</span><br><span class="line">  &#x27;/api&#x27;: &#123;</span><br><span class="line">     target: <span class="string">&#x27;http://localhost:8080&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">...</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h5 id="3-Vue-cli-3-x"><a href="#3-Vue-cli-3-x" class="headerlink" title="3) Vue-cli 3.x"></a>3) Vue-cli 3.x</h5><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js 如果没有就新建</span></span><br><span class="line">复制代码</span><br><span class="line"><span class="keyword">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: <span class="number">8000</span>,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        target: <span class="string">&quot;http://localhost:8080&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h5 id="4-Parcel-2-x"><a href="#4-Parcel-2-x" class="headerlink" title="4) Parcel (2.x)"></a>4) Parcel (2.x)</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .proxyrc</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;/api&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>看到这里，心里一句 xxx 就会脱口而出，一会写配置文件，一会 proxyTable ，一会 proxy，怎么这么多的形式？学不动了学不动了。。。不过也不用慌，还是有方法的。以上所有配置都是有着共同的底层包 <a href="https://link.juejin.cn/?target=https://github.com/chimurai/http-proxy-middleware">http-proxy-middleware</a> .里面需要用到的各种 <code>websocket</code> ，<code>rewrite</code> 等功能，直接看这个库的配置就可以了。关于 http-proxy-middleware 这个库的原理可以看我这篇文章 <a href="https://link.juejin.cn/?target=https://github.com/hua1995116/proxy">github.com&#x2F;hua1995116&#x2F;…</a> 当然了。。。对于配置的位置入口还是非统一的。教一个搜索的技巧吧，上面配置写哪里都不用记的，想要哪个框架的 直接 google 搜索 xxx proxy 就行了。</p>
<p>例如 vue-cli 2 proxy 、 webpack proxy 等等….基本会搜到有官网的配置答案，通用且 nice。</p>
<h4 id="b-使用自己的代理工具"><a href="#b-使用自己的代理工具" class="headerlink" title="b.使用自己的代理工具"></a>b.使用自己的代理工具</h4><p><a href="https://link.juejin.cn/?target=https://github.com/Rob--W/cors-anywhere">cors-anywhere</a></p>
<p><strong>「服务端」</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Listen on a specific host via the HOST environment variable</span></span><br><span class="line"><span class="keyword">var</span> host = process.<span class="property">env</span>.<span class="property">HOST</span> || <span class="string">&quot;0.0.0.0&quot;</span>;</span><br><span class="line"><span class="comment">// Listen on a specific port via the PORT environment variable</span></span><br><span class="line"><span class="keyword">var</span> port = process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">7777</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cors_proxy = <span class="built_in">require</span>(<span class="string">&quot;cors-anywhere&quot;</span>);</span><br><span class="line">cors_proxy</span><br><span class="line">  .<span class="title function_">createServer</span>(&#123;</span><br><span class="line">    <span class="attr">originWhitelist</span>: [], <span class="comment">// Allow all origins</span></span><br><span class="line">    <span class="attr">requireHeader</span>: [<span class="string">&quot;origin&quot;</span>, <span class="string">&quot;x-requested-with&quot;</span>],</span><br><span class="line">    <span class="attr">removeHeaders</span>: [<span class="string">&quot;cookie&quot;</span>, <span class="string">&quot;cookie2&quot;</span>]</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">listen</span>(port, host, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Running CORS Anywhere on &quot;</span> + host + <span class="string">&quot;:&quot;</span> + port);</span><br><span class="line">  &#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><strong>「前端代码」</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/axios/0.19.2/axios.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="attr">axios.defaults.withCredentials</span> = <span class="literal">true</span><span class="comment">;</span></span><br><span class="line">  <span class="attr">getlist.onclick</span> = () =&gt; &#123;</span><br><span class="line">    axios</span><br><span class="line">      .get(&quot;http://127.0.0.1:7777/http://127.0.0.1:8080/api/corslist&quot;)</span><br><span class="line">      .then(<span class="attr">res</span> =&gt; &#123;</span><br><span class="line">        console.log(res.data)<span class="comment">;</span></span><br><span class="line">      &#125;)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">  <span class="attr">login.onclick</span> = () =&gt; &#123;</span><br><span class="line">    axios.post(&quot;http://127.0.0.1:7777/http://127.0.0.1:8080/api/login&quot;)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><strong>「效果展示」</strong></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441cb6f2bc19~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200413161243734">image-20200413161243734</p>
<p><strong>「缺点」</strong></p>
<p>无法专递 cookie，原因是因为这个是一个代理库，作者觉得中间传递 cookie 太不安全了。<a target="_blank" rel="noopener" href="https://github.com/Rob--W/cors-anywhere/issues/208#issuecomment-575254153">https://github.com/Rob--W/cors-anywhere/issues/208#issuecomment-575254153</a></p>
<h4 id="c-charles"><a href="#c-charles" class="headerlink" title="c.charles"></a>c.charles</h4><h5 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h5><p>这是一个测试、开发的神器。<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903665304600589">介绍与使用</a></p>
<p>利用 charles 进行跨域，本质就是请求的拦截与代理。</p>
<p>在 <code>tools/map remote</code> 中设置代理</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441cc6dd6025~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412232733437">image-20200412232733437</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441cbaceed71~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412232724518">image-20200412232724518</p>
<h5 id="前端代码"><a href="#前端代码" class="headerlink" title="前端代码"></a>前端代码</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;button <span class="attr">id</span>=<span class="string">&quot;getlist&quot;</span>&gt;获取列表&lt;/button&gt;</span><br><span class="line">&lt;button <span class="attr">id</span>=<span class="string">&quot;login&quot;</span>&gt;登录&lt;/button&gt;</span><br><span class="line">&lt;script <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/axios/0.19.2/axios.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="attr">axios.defaults.withCredentials</span> = <span class="literal">true</span><span class="comment">;</span></span><br><span class="line">  <span class="attr">getlist.onclick</span> = () =&gt; &#123;</span><br><span class="line">    axios.get(&quot;/api/corslist&quot;).then(<span class="attr">res</span> =&gt; &#123;</span><br><span class="line">      console.log(res.data)<span class="comment">;</span></span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">  <span class="attr">login.onclick</span> = () =&gt; &#123;</span><br><span class="line">    axios.post(&quot;/api/login&quot;)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h5 id="后端代码"><a href="#后端代码" class="headerlink" title="后端代码"></a>后端代码</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">router.get(&quot;/api/corslist&quot;, async <span class="attr">ctx</span> =&gt; &#123;</span><br><span class="line">  <span class="attr">ctx.body</span> = &#123;</span><br><span class="line">    data: <span class="section">[&#123; name: &quot;秋风的笔记&quot; &#125;]</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">&#125;)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">router.post(&quot;/api/login&quot;, async <span class="attr">ctx</span> =&gt; &#123;</span><br><span class="line">  ctx.cookies.set(&quot;token&quot;, token, &#123;</span><br><span class="line">    expires: new Date(+new Date() + 1000 * 60 * 60 * 24 * 7)</span><br><span class="line">  &#125;)<span class="comment">;</span></span><br><span class="line">  <span class="attr">ctx.body</span> = &#123;</span><br><span class="line">    msg: &quot;成功&quot;,</span><br><span class="line">    code: 0</span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">&#125;)<span class="comment">;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h5 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h5><p>访问 <a target="_blank" rel="noopener" href="http://localhost:8000/charles">http://localhost:8000/charles</a></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441cbec7ed57~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412232231554">image-20200412232231554</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441cd9e700b2~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412232752837">image-20200412232752837</p>
<p>完美解决。</p>
<p>唔。这里又有一个注意点。在 <code>Mac mojave 10.14</code> 中会出现 <code>charles</code> 抓不到本地包的情况。这个时候需要自定义一个域名，然后配置<code>hosts</code>指定到<code>127.0.0.1</code>。然后修改访问方式 <code>http://localhost.charlesproxy.com:8000/charles</code>。</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441cdd4ea97d~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412233258107">image-20200412233258107</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441cc31c4e9f~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412233317027">image-20200412233317027</p>
<h3 id="3-Nginx-反向代理"><a href="#3-Nginx-反向代理" class="headerlink" title="3.Nginx 反向代理"></a>3.Nginx 反向代理</h3><h5 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h5><p>Nginx 则是通过反向代理的方式，（这里也需要自定义一个域名）这里就是保证我当前域，能获取到静态资源和接口，不关心是怎么获取的。<a href="https://link.juejin.cn/?target=https://blog.csdn.net/diaojw090/article/details/89135073">nginx 安装教程</a></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441ced140b98~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200412233536522">image-20200412233536522</p>
<p>配置下 hosts</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 local.test</span><br></pre></td></tr></table></figure>

<p>配置 nginx</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 80<span class="comment">;</span></span><br><span class="line">        server_name local.test<span class="comment">;</span></span><br><span class="line">        location /api &#123;</span><br><span class="line">            proxy_pass http://localhost:8080<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://localhost:8000<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>启动 nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx</span><br></pre></td></tr></table></figure>

<p>重启 nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -s reload</span><br></pre></td></tr></table></figure>

<h5 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h5><p>前端代码</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="attr">axios.defaults.withCredentials</span> = <span class="literal">true</span><span class="comment">;</span></span><br><span class="line">  <span class="attr">getlist.onclick</span> = () =&gt; &#123;</span><br><span class="line">    axios.get(&quot;/api/corslist&quot;).then(<span class="attr">res</span> =&gt; &#123;</span><br><span class="line">      console.log(res.data)<span class="comment">;</span></span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">  <span class="attr">login.onclick</span> = () =&gt; &#123;</span><br><span class="line">    axios.post(&quot;/api/login&quot;)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>后端代码</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">router.get(&quot;/api/corslist&quot;, async <span class="attr">ctx</span> =&gt; &#123;</span><br><span class="line">  <span class="attr">ctx.body</span> = &#123;</span><br><span class="line">    data: <span class="section">[&#123; name: &quot;秋风的笔记&quot; &#125;]</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">&#125;)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">router.post(&quot;/api/login&quot;, async <span class="attr">ctx</span> =&gt; &#123;</span><br><span class="line">  ctx.cookies.set(&quot;token&quot;, token, &#123;</span><br><span class="line">    expires: new Date(+new Date() + 1000 * 60 * 60 * 24 * 7)</span><br><span class="line">  &#125;)<span class="comment">;</span></span><br><span class="line">  <span class="attr">ctx.body</span> = &#123;</span><br><span class="line">    msg: &quot;成功&quot;,</span><br><span class="line">    code: 0</span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">&#125;)<span class="comment">;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h5 id="效果-1"><a href="#效果-1" class="headerlink" title="效果"></a>效果</h5><p>访问 <code>http://local.test/charles</code></p>
<p>浏览器显示</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441ced0491cf~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200413000229326">image-20200413000229326</p>
<h3 id="4-JSONP"><a href="#4-JSONP" class="headerlink" title="4.JSONP"></a>4.JSONP</h3><p><code>JSONP</code> 主要就是利用了 <code>script</code> 标签没有跨域限制的这个特性来完成的。</p>
<p><strong>「使用限制」</strong></p>
<p>仅支持 GET 方法，如果想使用完整的 REST 接口，请使用 CORS 或者其他代理方式。</p>
<p><strong>「流程解析」</strong></p>
<p>1.前端定义解析函数（例如 jsonpCallback&#x3D;function(){….}）</p>
<p>2.通过 params 形式包装请求参数，并且声明执行函数(例如 cb&#x3D;jsonpCallback)</p>
<p>3.后端获取前端声明的执行函数（jsonpCallback），并以带上参数并调用执行函数的方式传递给前端。</p>
<p><strong>「使用示例」</strong></p>
<p>后端实现</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const <span class="attr">Koa</span> = require(<span class="string">&quot;koa&quot;</span>)<span class="comment">;</span></span><br><span class="line">const <span class="attr">fs</span> = require(<span class="string">&quot;fs&quot;</span>)<span class="comment">;</span></span><br><span class="line">const <span class="attr">app</span> = new Koa()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">app.use(async (ctx, next) =&gt; &#123;</span><br><span class="line">  if (<span class="attr">ctx.path</span> === <span class="string">&quot;/api/jsonp&quot;</span>) &#123;</span><br><span class="line">    const &#123; cb, msg &#125; = ctx.query<span class="comment">;</span></span><br><span class="line">    <span class="attr">ctx.body</span> = `<span class="variable">$&#123;cb&#125;</span>(<span class="variable">$&#123;JSON.stringify(&#123; msg &#125;</span>)&#125;)`<span class="comment">;</span></span><br><span class="line">    return<span class="comment">;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">app.listen(8080)<span class="comment">;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>普通 js 示例</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">  <span class="attr">window.jsonpCallback</span> = function(res) &#123;</span><br><span class="line">    console.log(res)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script</span><br><span class="line">  <span class="attr">src</span>=<span class="string">&quot;http://localhost:8080/api/jsonp?msg=hello&amp;cb=jsonpCallback&quot;</span></span><br><span class="line">  <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span></span><br><span class="line">&gt;&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>JQuery Ajax 示例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/jquery/3.5.0/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/api/jsonp&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">dataType</span>: <span class="string">&quot;jsonp&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">msg</span>: <span class="string">&quot;hello&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">jsonp</span>: <span class="string">&quot;cb&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><strong>「原理解析」</strong></p>
<p>其实这就是 js 的魔法</p>
<p>我们先来看最简单的 js 调用。嗯，很自然的调用。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="property">jsonpCallback</span> = <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  jsonpCallback(&#123; a: 1 &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>我们稍稍改造一下，外链的形式。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="property">jsonpCallback</span> = <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:8080/api/a.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// http://localhost:8080/api/a.js jsonpCallback(&#123;a:1&#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>我们再改造一下，我们把这个外链的 js 就当做是一个动态的接口，因为本身资源和接口一样，是一个请求，也包含各种参数，也可以动态化返回。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="property">jsonpCallback</span> = <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:8080/api/a.js?a=123&amp;cb=sonpCallback&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// http://localhost:8080/api/a.js jsonpCallback(&#123;a:123&#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>你仔细品，细细品，是不是 jsonp 有的优势就是 script 加载 js 的优势，加载的方式只不过换了一种说法。这也告诉我们一个道理，很多东西并没有那么神奇，是在你所学的知识范围内。就好比，桃树和柳树，如果你把他们当成很大跨度的东西去记忆理解，那么世上这么多树，你真的要累死了，你把他们都当成是树，哦吼？你会突然发现，你对世界上所有的树都有所了解，他们都会长叶子，光合作用….当然也有个例，但是你只需要去记忆这些细微的差别，抓住主干。。。嗯，反正就这么个道理。</p>
<h3 id="5-Websocket"><a href="#5-Websocket" class="headerlink" title="5.Websocket"></a>5.Websocket</h3><p><a href="https://link.juejin.cn/?target=http://dev.w3.org/html5/websockets/">WebSocket</a> 规范定义了一种 API，可在网络浏览器和服务器之间建立“套接字”连接。简单地说：客户端和服务器之间存在持久的连接，而且双方都可以随时开始发送数据。详细教程可以看 <a target="_blank" rel="noopener" href="https://www.html5rocks.com/zh/tutorials/websockets/basics/">https://www.html5rocks.com/zh/tutorials/websockets/basics/</a></p>
<p>这种方式本质没有使用了 HTTP 的响应头, 因此也没有跨域的限制，没有什么过多的解释直接上代码吧。</p>
<p>前端部分</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  let <span class="attr">socket</span> = new WebSocket(<span class="string">&quot;ws://localhost:8080&quot;</span>)<span class="comment">;</span></span><br><span class="line">  <span class="attr">socket.onopen</span> = function() &#123;</span><br><span class="line">    socket.send(&quot;秋风的笔记&quot;)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">  <span class="attr">socket.onmessage</span> = function(e) &#123;</span><br><span class="line">    console.log(e.data)<span class="comment">;</span></span><br><span class="line">  &#125;<span class="comment">;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>后端部分</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> WebSocket = require(<span class="string">&quot;ws&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">server</span> = <span class="keyword">new</span> WebSocket.<span class="built_in">Server</span>(&#123; port: <span class="number">8080</span> &#125;);</span><br><span class="line"><span class="built_in">server</span>.<span class="keyword">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="keyword">function</span>(socket) &#123;</span><br><span class="line">  socket.<span class="keyword">on</span>(<span class="string">&quot;message&quot;</span>, <span class="keyword">function</span>(data) &#123;</span><br><span class="line">    socket.send(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="6-window-postMessage"><a href="#6-window-postMessage" class="headerlink" title="6.window.postMessage"></a>6.window.postMessage</h3><p><strong>「window.postMessage()」</strong> 方法可以安全地实现跨源通信。通常，对于两个不同页面的脚本，只有当执行它们的页面位于具有相同的协议（通常为 https），端口号（443 为 https 的默认值），以及主机 (两个页面的模数 <a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/API/Document/domain"><code>Document.domain</code></a>设置为相同的值) 时，这两个脚本才能相互通信。<strong>「window.postMessage()」</strong> 方法提供了一种受控机制来规避此限制，只要正确的使用，这种方法就很安全。</p>
<h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><p>1.页面和其打开的新窗口的数据传递</p>
<p>2.多窗口之间消息传递</p>
<p>3.页面与嵌套的 iframe 消息传递</p>
<h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><p>详细用法看 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">otherWindow.postMessage(message, targetOrigin, [transfer]);</span><br></pre></td></tr></table></figure>

<ul>
<li>otherWindow: 其他窗口的一个引用，比如 iframe 的 contentWindow 属性、执行<a href="https://link.juejin.cn/?target=https://developer.mozilla.org/en-US/docs/DOM/window.open">window.open</a>返回的窗口对象、或者是命名过或数值索引的<a href="https://link.juejin.cn/?target=https://developer.mozilla.org/en-US/docs/DOM/window.frames">window.frames</a>。</li>
<li>message: 将要发送到其他 window 的数据。</li>
<li>targetOrigin: 通过窗口的 origin 属性来指定哪些窗口能接收到消息事件.</li>
<li>transfer(可选) : 是一串和 message 同时传递的 <a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/API/Transferable"><code>Transferable</code></a> 对象. 这些对象的所有权将被转移给消息的接收方，而发送一方将不再保有所有权</li>
</ul>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>index.html</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe</span><br><span class="line">  <span class="attr">src</span>=<span class="string">&quot;http://localhost:8080&quot;</span></span><br><span class="line">  <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span></span><br><span class="line">  <span class="attr">id</span>=<span class="string">&quot;iframe&quot;</span></span><br><span class="line">  <span class="attr">onload</span>=<span class="string">&quot;load()&quot;</span></span><br><span class="line">&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  function load() &#123;</span><br><span class="line">    iframe.contentWindow.postMessage(&quot;秋风的笔记&quot;, &quot;http://localhost:8080&quot;)<span class="comment">;</span></span><br><span class="line">    <span class="attr">window.onmessage</span> = e =&gt; &#123;</span><br><span class="line">      console.log(e.data)<span class="comment">;</span></span><br><span class="line">    &#125;<span class="comment">;</span></span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>another.html</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="property">onmessage</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">data</span>); <span class="comment">// 秋风的笔记</span></span></span><br><span class="line"><span class="language-javascript">    e.<span class="property">source</span>.<span class="title function_">postMessage</span>(e.<span class="property">data</span>, e.<span class="property">origin</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="7-document-domain-Iframe"><a href="#7-document-domain-Iframe" class="headerlink" title="7.document.domain + Iframe"></a>7.document.domain + Iframe</h3><p>从第 7 种到第 9 种方式，我觉得别人的写的已经很好了，为了完整性，我就拿别人的了。如有雷同….（不对，就是雷同….）不要说不出来。</p>
<p><strong>「该方式只能用于二级域名相同的情况下，比如 <code>a.test.com</code> 和 <code>b.test.com</code> 适用于该方式」</strong>。 只需要给页面添加 <code>document.domain =&#39;test.com&#39;</code> 表示二级域名都相同就可以实现跨域。</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">www.   baidu.  com     .</span><br><span class="line">三级域  二级域   顶级域   根域</span><br><span class="line">复制代码</span><br><span class="line">// a.test.com</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  helloa</span><br><span class="line">  &lt;iframe</span><br><span class="line">    src=<span class="string">&quot;http://b.test.com/b.html&quot;</span></span><br><span class="line">    frameborder=<span class="string">&quot;0&quot;</span></span><br><span class="line">    onload=<span class="string">&quot;load()&quot;</span></span><br><span class="line">    id=<span class="string">&quot;frame&quot;</span></span><br><span class="line">  &gt;&lt;/iframe&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    document.domain = <span class="string">&quot;test.com&quot;</span>;</span><br><span class="line">    function load() &#123;</span><br><span class="line">      console.log(frame.contentWindow.a);</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">复制代码</span><br><span class="line">// b.test.com</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  hellob</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    document.domain = <span class="string">&quot;test.com&quot;</span>;</span><br><span class="line">    var a = <span class="number">100</span>;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="8-window-location-hash-Iframe"><a href="#8-window-location-hash-Iframe" class="headerlink" title="8.window.location.hash + Iframe"></a>8.window.location.hash + Iframe</h3><h4 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h4><p>原理就是通过 url 带 hash ，通过一个非跨域的中间页面来传递数据。</p>
<h4 id="实现流程"><a href="#实现流程" class="headerlink" title="实现流程"></a>实现流程</h4><p>一开始 a.html 给 c.html 传一个 hash 值，然后 c.html 收到 hash 值后，再把 hash 值传递给 b.html，最后 b.html 将结果放到 a.html 的 hash 值中。 同样的，a.html 和 b.htm l 是同域的，都是 <code>http://localhost:8000</code>，而 c.html 是<code>http://localhost:8080</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// a.html</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:8080/hash/c.html#name1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">hash</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="property">onhashchange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">hash</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br><span class="line">// b.html</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="property">parent</span>.<span class="property">parent</span>.<span class="property">location</span>.<span class="property">hash</span> = location.<span class="property">hash</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br><span class="line">// c.html</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">hash</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> iframe = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;iframe&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">  iframe.<span class="property">src</span> = <span class="string">&quot;http://localhost:8000/hash/b.html#name2&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(iframe);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="9-window-name-Iframe"><a href="#9-window-name-Iframe" class="headerlink" title="9.window.name + Iframe"></a>9.window.name + Iframe</h3><p>window 对象的 name 属性是一个很特别的属性，当该 window 的 location 变化，然后重新加载，它的 name 属性可以依然保持不变。</p>
<p>其中 a.html 和 b.html 是同域的，都是<code>http://localhost:8000</code>，而 c.html 是<code>http://localhost:8080</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// a.html</span><br><span class="line">&lt;iframe</span><br><span class="line">  <span class="attr">src</span>=<span class="string">&quot;http://localhost:8080/name/c.html&quot;</span></span><br><span class="line">  <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span></span><br><span class="line">  <span class="attr">onload</span>=<span class="string">&quot;load()&quot;</span></span><br><span class="line">  <span class="attr">id</span>=<span class="string">&quot;iframe&quot;</span></span><br><span class="line">&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  let <span class="attr">first</span> = <span class="literal">true</span><span class="comment">;</span></span><br><span class="line">  // onload事件会触发2次，第1次加载跨域页，并留存数据于window.name</span><br><span class="line">  function load() &#123;</span><br><span class="line">    if (first) &#123;</span><br><span class="line">      // 第1次onload(跨域页)成功后，切换到同域代理页面</span><br><span class="line">      <span class="attr">iframe.src</span> = <span class="string">&quot;http://localhost:8000/name/b.html&quot;</span><span class="comment">;</span></span><br><span class="line">      <span class="attr">first</span> = <span class="literal">false</span><span class="comment">;</span></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 第2次onload(同域b.html页)成功后，读取同域window.name中数据</span><br><span class="line">      console.log(iframe.contentWindow.name)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>b.html 为中间代理页，与 a.html 同域，内容为空。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// <span class="selector-tag">b</span><span class="selector-class">.html</span></span><br><span class="line">&lt;<span class="selector-tag">div</span>&gt;&lt;/<span class="selector-tag">div</span>&gt;</span><br><span class="line">复制代码</span><br><span class="line">// c<span class="selector-class">.html</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  window<span class="selector-class">.name</span> = &quot;秋风的笔记&quot;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>通过 iframe 的 src 属性由外域转向本地域，跨域数据即由 iframe 的 window.name 从外域传递到本地域。这个就巧妙地绕过了浏览器的跨域访问限制，但同时它又是安全操作。</p>
<h3 id="10-浏览器开启跨域（终极方案）"><a href="#10-浏览器开启跨域（终极方案）" class="headerlink" title="10.浏览器开启跨域（终极方案）"></a>10.浏览器开启跨域（终极方案）</h3><p>其实讲下其实跨域问题是浏览器策略，源头是他，那么能否能关闭这个功能呢？</p>
<p>答案是肯定的。</p>
<p><strong>「注意事项: 因为浏览器是众多 web 页面入口。我们是否也可以像客户端那种，就是用一个单独的专门宿主浏览器，来打开调试我们的开发页面。例如这里以 chrome canary 为例，这个是我专门调试页面的浏览器，不会用它来访问其他 web url。因此它也相对于安全一些。当然这个方式，只限于当你真的被跨域折磨地崩溃的时候才建议使用以下。使用后，请以正常的方式将他打开，以免你不小心用这个模式干了其他的事。」</strong></p>
<h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">找到你安装的目录</span><br><span class="line">.\Google\Chrome\Application\chrome<span class="selector-class">.exe</span> <span class="attr">--disable-web-security</span> <span class="attr">--user-data-dir</span>=xxxx</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h4 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h4><p><code>~/Downloads/chrome-data</code> 这个目录可以自定义.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/Applications/Google\ Chrome\ Canary<span class="selector-class">.app</span>/Contents/MacOS/Google\ Chrome\ Canary  <span class="attr">--disable-web-security</span> <span class="attr">--user-data-dir</span>=~/Downloads/chrome-data</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h4 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h4><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441ced02165c~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200413143102377">image-20200413143102377</p>
<p>嗯，使用起来很香，但是再次提醒，一般情况千万别轻易使用这个方式，这个方式好比七伤拳，使用的好威力无比，使用不好，很容易伤到自己。</p>
<h2 id="三、为什么需要跨域？"><a href="#三、为什么需要跨域？" class="headerlink" title="三、为什么需要跨域？"></a>三、为什么需要跨域？</h2><p>在最一开始，我们知道了，跨域只存在于浏览器端。而浏览器为 web 提供访问入口。我们在可以浏览器内打开很多页面。正是这样的开放形态，所以我们需要对他有所限制。就比如林子大了，什么鸟都有，我们需要有一个统一的规范来进行约定才能保障这个安全性。</p>
<h3 id="1-限制不同源的请求"><a href="#1-限制不同源的请求" class="headerlink" title="1.限制不同源的请求"></a>1.限制不同源的请求</h3><p>这里还是用最常用的方式来讲解，例如用户登录 a 网站，同时新开 tab 打开了 b 网站，如果不限制同源， b 可以像 a 网站发起任何请求，会让不法分子有机可趁。</p>
<h3 id="2-限制-dom-操作"><a href="#2-限制-dom-操作" class="headerlink" title="2.限制 dom 操作"></a>2.限制 dom 操作</h3><p>我举个例子吧, 你先登录下 <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> ,然后访问我这个网址。</p>
<p><a target="_blank" rel="noopener" href="https://zerolty.com/node-demo/index.html">https://zerolty.com/node-demo/index.html</a></p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/13/1717441cf1366618~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="image-20200413190413758">image-20200413190413758</p>
<p>你会发现，这个和真实的百度一模一样，如果再把域名搞的相似一些，是不是很容易被骗，如果可以进行 dom 操作…那么大家的信息在这种钓鱼网站眼里都是一颗颗小白菜，等着被收割。</p>
<blockquote>
<p>❝</p>
<p>可以在 http 返回头 添加<code>X-Frame-Options: SAMEORIGIN</code> 防止被别人添加至 iframe。</p>
<p>❞</p>
</blockquote>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>以上最常用的就是前 4 种方式，特别是第 2 种非常常见，我里面也提到了多种示例，大家可以慢慢消化一下。希望未来有更加安全的方式来限制 web ，解决跨域的头疼，哈哈哈哈。</p>
<p>作者：程序员秋风<br>链接：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904126246027278">https://juejin.cn/post/6844904126246027278</a><br>来源：稀土掘金</p>
</div><div class="tags"><a href="/tags/前端"><i class="fa fa-tag">前端</i></a></div><div class="post-nav"><a class="pre" href="/2020/04/15/java/Spring%20Boot%20%E7%9A%84%2016%20%E6%9D%A1%E5%AE%9E%E8%B7%B5%E8%A7%A3%E8%AF%BB/">Spring Boot 的 16 条实践解读</a><a class="next" href="/2020/03/09/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/%E8%81%8A%E8%81%8AAPI%E7%BD%91%E5%85%B3%E7%9A%84%E4%BD%9C%E7%94%A8/">聊聊API网关的作用</a></div><div id="waline"></div><script src="//unpkg.com/@waline/client@v2/dist/waline.js"></script><link rel="stylesheet" type="text/css" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script>let metaInfo = ['nick', 'mail', 'link']
let requiredMeta = 'nick,mail'.split(',').filter(item => {
  return metaInfo.indexOf(item) > -1
})
Waline.init({
  el: '#waline',
  comment: true,
  serverURL: 'https://comment.aimak.cn',
  pageSize: '30',
  wordLimit: '500',
  requiredMeta,
})
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img src="/img/avatar.png"/></a><p>认真生活.</p><a class="info-icon" href="https://twitter.com/fantasykaicc" title="Twitter" target="_blank" style="margin-inline:5px"> <i class="fa fa-twitter-square" style="margin-inline:5px"></i></a><a class="info-icon" href="mailto:makren@126.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/fantasykai" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AI/">AI</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%B9%E5%99%A8/">容器</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a><span class="category-list-count">34</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/">技术小栈</a><span class="category-list-count">113</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E8%AE%B0/">杂记</a><span class="category-list-count">70</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%93%E5%AD%98/">缓存</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">网络</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%AD%E5%BD%95/">语录</a><span class="category-list-count">16</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">深度学习</a> <a href="/tags/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/" style="font-size: 15px;">知识图谱</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/Chrome-%E6%95%88%E7%8E%87%E6%8F%92%E4%BB%B6/" style="font-size: 15px;">Chrome 效率插件</a> <a href="/tags/idea/" style="font-size: 15px;">idea</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 15px;">运维</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 15px;">工具</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 15px;">缓存</a> <a href="/tags/Jenkins/" style="font-size: 15px;">Jenkins</a> <a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 15px;">容器</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/restful/" style="font-size: 15px;">restful</a> <a href="/tags/IPv6/" style="font-size: 15px;">IPv6</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/PMO/" style="font-size: 15px;">PMO</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15px;">前端</a> <a href="/tags/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/" style="font-size: 15px;">技术小栈</a> <a href="/tags/CAP/" style="font-size: 15px;">CAP</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 15px;">架构</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/ideas/" style="font-size: 15px;">ideas</a> <a href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/" style="font-size: 15px;">高并发</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 15px;">并发</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 15px;">测试</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 15px;">日志</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/SDN/" style="font-size: 15px;">SDN</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">网络</a> <a href="/tags/%E6%8A%A5%E5%91%8A%E5%88%86%E4%BA%AB/" style="font-size: 15px;">报告分享</a> <a href="/tags/%E6%9D%82%E8%AE%B0/" style="font-size: 15px;">杂记</a> <a href="/tags/%E6%8A%80%E6%9C%AF%E5%9B%A2%E9%98%9F/" style="font-size: 15px;">技术团队</a> <a href="/tags/%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87/" style="font-size: 15px;">开发效率</a> <a href="/tags/thymeleaf/" style="font-size: 15px;">thymeleaf</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/%E8%AF%AD%E5%BD%95/" style="font-size: 15px;">语录</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2024/03/26/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/%E5%9F%BA%E4%BA%8E%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E9%A2%84%E6%B5%8B/">基于神经网络的网络流量预测</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/01/06/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/2023%20%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E6%8A%80%E6%9C%AF%E7%B2%BE%E9%80%89%E6%8A%80%E6%9C%AF%E5%B9%B2%E8%B4%A7/">2023 哔哩哔哩技术精选技术干货</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/12/28/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/2023%20%E4%B8%AD%E5%9B%BD%E5%BC%80%E6%BA%90%E5%BC%80%E5%8F%91%E8%80%85%E6%8A%A5%E5%91%8A/">2023 中国开源开发者报告</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/11/23/%E6%9D%82%E8%AE%B0/%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E8%A7%84%E8%8C%83/">系统性能指标规范</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/10/16/%E6%9D%82%E8%AE%B0/%E8%BF%90%E5%8A%A8%E7%9A%84%E6%9D%A0%E6%9D%86%EF%BC%9A%E7%9C%9F%E6%AD%A3%E6%9C%89%E6%95%88%E7%9A%84%E9%94%BB%E7%82%BC%E6%96%B9%E6%B3%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/">得到精选｜运动的杠杆：真正有效的锻炼方法是什么</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/10/08/%E7%BD%91%E7%BB%9C/%E8%BF%90%E8%90%A5%E5%95%86%E7%9A%84%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84%E6%98%AF%E4%BB%80%E4%B9%88/">运营商的网络架构</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/10/01/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/%E5%BC%80%E6%BA%90%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7%E7%AE%80%E4%BB%8B/">开源系统监控工具简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/21/%E5%B7%A5%E5%85%B7/%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC%E6%8E%A9%E7%9B%96MBP%E9%97%AA%E7%83%81%E9%97%AE%E9%A2%98/">使用脚本掩盖MBP闪烁问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/08/%E8%AF%AD%E5%BD%95/%E5%8F%B2%E9%93%81%E7%94%9F%E8%AF%AD%E5%BD%9502/">史铁生语录02</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/07/%E8%AF%AD%E5%BD%95/%E5%8F%B2%E9%93%81%E7%94%9F%E8%AF%AD%E5%BD%9501/">史铁生语录01</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><div id="widget-waline-list"></div><script type="text/javascript" id="recent-comment" serverURL="https://comment.aimak.cn" count="5" src="/js/recent-comments.js?v=1.0.0" async="async"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://landscape.cncf.io/" title="CNCF" target="_blank">CNCF</a><ul></ul><a href="https://segmentfault.com/" title="SegmentFault" target="_blank">SegmentFault</a><ul></ul><a href="https://blog.csdn.net/junbaozi/category_11649936_3.html" title="CloudNative" target="_blank">CloudNative</a><ul></ul><a href="https://excalidraw.com/" title="excalidraw" target="_blank">excalidraw</a><ul></ul><a href="https://tudan.blog.csdn.net/?type=lately" title="王坦" target="_blank">王坦</a><ul></ul><a href="https://aspoem.com/zh-Hans" target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">枫哲's文栖小筑.</a><a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn/">｜苏ICP备18013756号-1</a><!--a(rel='nofollow', target='_blank', href='https://github.com/tufu9441/maupassant-hexo')  Theme--><!--|  by--><!--a(rel='nofollow', target='_blank', href='https://github.com/pagecho')  Cho.--></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>