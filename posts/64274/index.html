<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="fantasykai`blog"><title>ThreadLocalçš„ä½œç”¨ä»¥åŠåº”ç”¨åœºæ™¯ | æ«å“²'sæ–‡æ –å°ç­‘</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + '2bb92548008bd1f1f88213efd40c8dad';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ThreadLocalçš„ä½œç”¨ä»¥åŠåº”ç”¨åœºæ™¯</h1><a id="logo" href="/.">æ«å“²'sæ–‡æ –å°ç­‘</a><p class="description">å›å­ç»ˆæ—¥ä¹¾ä¹¾ï¼Œå¤•æƒ•è‹¥å‰ï¼Œæ— å’</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/tags/"><i class="fa fa-tag"> æ ‡ç­¾</i></a><a href="/timeline/"><i class="fa fa-book"> å†å²</i></a><a href="/blogroll/"><i class="fa fa-external-link"> æ”¶è—é“¾æ¥</i></a><a href="/2048/"><i class="fa fa-gamepad"> æ”¾æ¾ä¸‹</i></a><a href="/guestbook/"><i class="fa fa-comments"> ç•™è¨€</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ThreadLocalçš„ä½œç”¨ä»¥åŠåº”ç”¨åœºæ™¯</h1><div class="post-meta">2021-05-30<span> | </span><span class="category"><a href="/categories/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/">æŠ€æœ¯å°æ ˆ</a></span></div><a class="disqus-comment-count" href="/posts/64274/#vcomment"><span class="waline-comment-count" id="/posts/64274/"></span><span> æ¡è¯„è®º</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#ThreadLocal%E7%9A%84%E4%BD%9C%E7%94%A8%E4%BB%A5%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">ThreadLocalçš„ä½œç”¨ä»¥åŠåº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.1.</span> <span class="toc-text">ä½¿ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">åŸç†åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ThreadLocalMap%E7%9A%84%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">ThreadLocalMapçš„åº•å±‚ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E4%BA%A7%E7%94%9F%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">3.1.</span> <span class="toc-text">å†…å­˜æ³„éœ²äº§ç”Ÿçš„åŸå› </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3Hash%E5%86%B2%E7%AA%81"><span class="toc-number">3.2.</span> <span class="toc-text">è§£å†³Hashå†²çª</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ThreadLocal%E6%97%B6%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F"><span class="toc-number">4.</span> <span class="toc-text">ä½¿ç”¨ThreadLocalæ—¶å¯¹è±¡å­˜åœ¨å“ªé‡Œï¼Ÿ</span></a></li></ol></div></div><div class="post-content"><h4 id="ThreadLocalçš„ä½œç”¨ä»¥åŠåº”ç”¨åœºæ™¯"><a href="#ThreadLocalçš„ä½œç”¨ä»¥åŠåº”ç”¨åœºæ™¯" class="headerlink" title="ThreadLocalçš„ä½œç”¨ä»¥åŠåº”ç”¨åœºæ™¯"></a>ThreadLocalçš„ä½œç”¨ä»¥åŠåº”ç”¨åœºæ™¯</h4><p>ThreadLocalç®—æ˜¯ä¸€ç§å¹¶å‘å®¹å™¨å§ï¼Œå› ä¸ºä»–çš„å†…éƒ¨æ˜¯æœ‰ThreadLocalMapç»„æˆï¼ŒThreadLocalæ˜¯ä¸ºäº†è§£å†³å¤šçº¿ç¨‹æƒ…å†µä¸‹å˜é‡ä¸èƒ½è¢«å…±äº«çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å¤šçº¿ç¨‹å…±äº«å˜é‡çš„é—®é¢˜ï¼›ThreadLocalå’ŒLockä»¥åŠSynchronizedçš„åŒºåˆ«æ˜¯ï¼šThreadLocalæ˜¯ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå˜é‡ï¼ˆå¯¹è±¡ï¼‰ï¼Œå„ä¸ªçº¿ç¨‹éƒ½å­˜æœ‰å˜é‡çš„å‰¯æœ¬ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ä½¿ç”¨è‡ªå·±ï¼ˆå˜é‡ï¼‰å¯¹è±¡å®ä¾‹ï¼Œä½¿çº¿ç¨‹ä¸çº¿ç¨‹ä¹‹é—´è¿›è¡Œéš”ç¦»ï¼›è€ŒLockå’ŒSynchronizedçš„æ–¹å¼æ˜¯ä½¿çº¿ç¨‹æœ‰é¡ºåºçš„æ‰§è¡Œï¼Œä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šç›®å‰æœ‰100ä¸ªå­¦ç”Ÿç­‰å¾…ç­¾å­—ï¼Œä½†æ˜¯è€å¸ˆåªæœ‰ä¸€ä¸ªç¬”ï¼Œé‚£è€å¸ˆåªèƒ½æŒ‰é¡ºåºçš„åˆ†ç»™æ¯ä¸ªå­¦ç”Ÿï¼Œç­‰å¾…Aå­¦ç”Ÿç­¾å­—å®Œæˆç„¶åå°†ç¬”äº¤ç»™Bå­¦ç”Ÿï¼Œè¿™å°±ç±»ä¼¼Lock,Synchronizedçš„æ–¹å¼ã€‚è€ŒThreadLocalæ˜¯ï¼Œè€å¸ˆç›´æ¥æ‹¿å‡ºä¸€ç™¾ä¸ªç¬”ç»™æ¯ä¸ªå­¦ç”Ÿï¼›å†æ•ˆç‡æé«˜çš„åŒäº‹ä¹Ÿè¦ä»˜å‡ºä¸€ä¸ªå†…å­˜æ¶ˆè€—ï¼›ä¹Ÿå°±æ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ¦‚å¿µ</p>
<h5 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h5><ul>
<li><p>Springçš„äº‹åŠ¡éš”ç¦»å°±æ˜¯ä½¿ç”¨ThreadLocalå’ŒAOPæ¥è§£å†³çš„ï¼›ä¸»è¦æ˜¯TransactionSynchronizationManagerè¿™ä¸ªç±»ï¼›</p>
</li>
<li><p>è§£å†³SimpleDateFormatçº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼›</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨SimpleDateFormatçš„parse()æ–¹æ³•çš„æ—¶å€™ï¼Œparse()æ–¹æ³•ä¼šå…ˆè°ƒç”¨Calendar.clear()æ–¹æ³•ï¼Œç„¶åè°ƒç”¨Calendar.add()æ–¹æ³•ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å…ˆè°ƒç”¨äº†add()æ–¹æ³•ï¼Œç„¶åå¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†clear()æ–¹æ³•ï¼›è¿™æ—¶å€™parse()æ–¹æ³•å°±ä¼šå‡ºç°è§£æé”™è¯¯ï¼›å¦‚æœä¸ä¿¡æˆ‘ä»¬å¯ä»¥æ¥ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleDateFormatTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">            <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                    dateFormat();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­—ç¬¦ä¸²è½¬æˆæ—¥æœŸç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dateFormat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            simpleDateFormat.parse(<span class="string">&quot;2021-5-27&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬åªå¯åŠ¨äº†50ä¸ªçº¿ç¨‹é—®é¢˜å°±ä¼šå‡ºç°ï¼Œå…¶å®çœ‹å·§ä¸å·§ï¼Œæœ‰æ—¶å€™åªæœ‰10ä¸ªçº¿ç¨‹çš„æƒ…å†µå°±ä¼šå‡ºé”™;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;Thread-40&quot;</span> java.lang.NumberFormatException: For input string: <span class="string">&quot;&quot;</span></span><br><span class="line">	at java.lang.NumberFormatException.forInputString(NumberFormatException.java:<span class="number">65</span>)</span><br><span class="line">	at java.lang.Long.parseLong(Long.java:<span class="number">601</span>)</span><br><span class="line">	at java.lang.Long.parseLong(Long.java:<span class="number">631</span>)</span><br><span class="line">	at java.text.DigitList.getLong(DigitList.java:<span class="number">195</span>)</span><br><span class="line">	at java.text.DecimalFormat.parse(DecimalFormat.java:<span class="number">2084</span>)</span><br><span class="line">	at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:<span class="number">1869</span>)</span><br><span class="line">	at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:<span class="number">1514</span>)</span><br><span class="line">	at java.text.DateFormat.parse(DateFormat.java:<span class="number">364</span>)</span><br><span class="line">	at cn.haoxy.use.lock.sdf.SimpleDateFormatTest.dateFormat(SimpleDateFormatTest.java:<span class="number">36</span>)</span><br><span class="line">	at cn.haoxy.use.lock.sdf.SimpleDateFormatTest$<span class="number">1.</span>run(SimpleDateFormatTest.java:<span class="number">23</span>)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line">Exception in thread <span class="string">&quot;Thread-43&quot;</span> java.lang.NumberFormatException: multiple points</span><br><span class="line">	at sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:<span class="number">1890</span>)</span><br><span class="line">	at sun.misc.FloatingDecimal.parseDouble(FloatingDecimal.java:<span class="number">110</span>)</span><br><span class="line">	at java.lang.Double.parseDouble(Double.java:<span class="number">538</span>)</span><br><span class="line">	at java.text.DigitList.getDouble(DigitList.java:<span class="number">169</span>)</span><br><span class="line">	at java.text.DecimalFormat.parse(DecimalFormat.java:<span class="number">2089</span>)</span><br><span class="line">	at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:<span class="number">1869</span>)</span><br><span class="line">	at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:<span class="number">1514</span>)</span><br><span class="line">	at java.text.DateFormat.parse(DateFormat.java:<span class="number">364</span>)</span><br><span class="line">	at  .............</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>å…¶å®è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œè®©æ¯ä¸ªçº¿ç¨‹newä¸€ä¸ªè‡ªå·±çš„SimpleDateFormatï¼Œä½†æ˜¯å¦‚æœ100ä¸ªçº¿ç¨‹éƒ½è¦new100ä¸ªSimpleDateFormatå—ï¼Ÿå½“ç„¶æˆ‘ä»¬ä¸èƒ½è¿™ä¹ˆåšï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©çº¿ç¨‹æ± åŠ ä¸ŠThreadLocalæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleDateFormatTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;SimpleDateFormat&gt; local = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;SimpleDateFormat&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">      	<span class="comment">//åˆå§‹åŒ–çº¿ç¨‹æœ¬åœ°å˜é‡</span></span><br><span class="line">        <span class="keyword">protected</span> SimpleDateFormat <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">es</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">500</span>; i++) &#123;</span><br><span class="line">            es.execute(() -&gt; &#123;</span><br><span class="line">              	<span class="comment">//è°ƒç”¨å­—ç¬¦ä¸²è½¬æˆæ—¥æœŸæ–¹æ³•</span></span><br><span class="line">                dateFormat();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        es.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­—ç¬¦ä¸²è½¬æˆæ—¥æœŸç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dateFormat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          	<span class="comment">//ThreadLocalä¸­çš„get()æ–¹æ³•</span></span><br><span class="line">            local.get().parse(<span class="string">&quot;2021-5-27&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ä¼˜é›…çš„è§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›</p>
</li>
<li><p>è§£å†³è¿‡åº¦ä¼ å‚é—®é¢˜ï¼›ä¾‹å¦‚ä¸€ä¸ªæ–¹æ³•ä¸­è¦è°ƒç”¨å¥½å¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½éœ€è¦ä¼ é€’å‚æ•°ï¼›ä¾‹å¦‚ä¸‹é¢ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">work</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    getInfo(user);</span><br><span class="line">    checkInfo(user);</span><br><span class="line">    setSomeThing(user);</span><br><span class="line">    log(user);</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>ç”¨äº†ThreadLocalä¹‹åï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalStu</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;User&gt; userThreadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">work</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userThreadLocal.set(user);</span><br><span class="line">            getInfo();</span><br><span class="line">            checkInfo();</span><br><span class="line">            someThing();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            userThreadLocal.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> userThreadLocal.get();</span><br><span class="line">        <span class="comment">//.....</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">checkInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> userThreadLocal.get();</span><br><span class="line">        <span class="comment">//....</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">someThing</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> userThreadLocal.get();</span><br><span class="line">        <span class="comment">//....</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure></li>
</ul>
<p>æ¯ä¸ªçº¿ç¨‹å†…éœ€è¦ä¿å­˜å…¨å±€å˜é‡ï¼ˆæ¯”å¦‚åœ¨ç™»å½•æˆåŠŸåå°†ç”¨æˆ·ä¿¡æ¯å­˜åˆ°<code>ThreadLocal</code>é‡Œï¼Œç„¶åå½“å‰çº¿ç¨‹æ“ä½œçš„ä¸šåŠ¡é€»è¾‘ç›´æ¥getå–å°±å®Œäº‹äº†ï¼Œæœ‰æ•ˆçš„é¿å…çš„å‚æ•°æ¥å›ä¼ é€’çš„éº»çƒ¦ä¹‹å¤„ï¼‰ï¼Œä¸€å®šå±‚çº§ä¸Šå‡å°‘ä»£ç è€¦åˆåº¦ã€‚</p>
<ul>
<li>æ¯”å¦‚å­˜å‚¨ äº¤æ˜“idç­‰ä¿¡æ¯ã€‚æ¯ä¸ªçº¿ç¨‹ç§æœ‰ã€‚</li>
<li>æ¯”å¦‚aopé‡Œè®°å½•æ—¥å¿—éœ€è¦beforeè®°å½•è¯·æ±‚idï¼Œendæ‹¿å‡ºè¯·æ±‚idï¼Œè¿™ä¹Ÿå¯ä»¥ã€‚</li>
<li>æ¯”å¦‚jdbcè¿æ¥æ± ï¼ˆå¾ˆå…¸å‹çš„ä¸€ä¸ª<code>ThreadLocal</code>ç”¨æ³•ï¼‰</li>
<li>â€¦.ç­‰ç­‰â€¦.</li>
</ul>
<h4 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h4><p>ä¸Šé¢æˆ‘ä»¬åŸºæœ¬ä¸ŠçŸ¥é“äº†ThreadLocalçš„ä½¿ç”¨æ–¹å¼ä»¥åŠåº”ç”¨åœºæ™¯ï¼Œå½“ç„¶åº”ç”¨åœºæ™¯ä¸æ­¢è¿™äº›è¿™åªæ˜¯å·¥ä½œä¸­å¸¸ç”¨åˆ°çš„åœºæ™¯ï¼›ä¸‹é¢æˆ‘ä»¬å¯¹å®ƒçš„åŸç†è¿›è¡Œåˆ†æ;</p>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å®ƒçš„set()æ–¹æ³•;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">        <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">            map.set(<span class="built_in">this</span>, value);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            createMap(t, value);</span><br><span class="line">    &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸æ˜¯ç‰¹åˆ«ç®€å•ï¼Œé¦–å…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œç”¨å½“å‰çº¿ç¨‹ä½œä¸ºkey,å»è·å–ThreadLocalMap,ç„¶ååˆ¤æ–­mapæ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºå°±å°†å½“å‰çº¿ç¨‹ä½œä¸ºkey,ä¼ å…¥çš„valueä½œä¸ºmapçš„valueå€¼ï¼›å¦‚æœä¸ºç©ºå°±åˆ›å»ºä¸€ä¸ªThreadLocalMap,ç„¶åå°†keyå’Œvalueæ–¹è¿›å»ï¼›ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºvalueå€¼æ˜¯å­˜æ”¾åˆ°ThreadLocalMapä¸­ï¼›</p>
<p>ç„¶åæˆ‘ä»¬çœ‹çœ‹ThreadLocalMapæ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿå…ˆçœ‹ä¸‹getMap()æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨Threadç±»ä¸­ç»´æŠ¤äº†threadLocalså˜é‡ï¼Œæ³¨æ„æ˜¯Threadç±»</span></span><br><span class="line">ThreadLocal.<span class="type">ThreadLocalMap</span> <span class="variable">threadLocals</span> <span class="operator">=</span> <span class="literal">null</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨ThreadLocalç±»ä¸­çš„getMap()æ–¹æ³•</span></span><br><span class="line">ThreadLocalMap <span class="title function_">getMap</span><span class="params">(Thread t)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">    &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>è¿™å°±èƒ½è§£é‡Šæ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ªThreadLocalMapï¼Œå› ä¸ºThreadLocalMapçš„å¼•ç”¨åœ¨Threadä¸­ç»´æŠ¤ï¼›è¿™å°±ç¡®ä¿äº†çº¿ç¨‹é—´çš„éš”ç¦»ï¼›</p>
<p>æˆ‘ä»¬ç»§ç»­å›åˆ°set()æ–¹æ³•ï¼Œçœ‹åˆ°å½“mapç­‰äºç©ºçš„æ—¶å€™<code>createMap(t, value);</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">void</span> <span class="title function_">createMap</span><span class="params">(Thread t, T firstValue)</span> &#123;</span><br><span class="line">        t.threadLocals = <span class="keyword">new</span> <span class="title class_">ThreadLocalMap</span>(<span class="built_in">this</span>, firstValue);</span><br><span class="line">    &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±æ˜¯newäº†ä¸€ä¸ªThreadLocalMapç„¶åèµ‹å€¼ç»™threadLocalsæˆå‘˜å˜é‡ï¼›ThreadLocalMapæ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">       ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;</span><br><span class="line">         <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªEntry   </span></span><br><span class="line">         table = <span class="keyword">new</span> <span class="title class_">Entry</span>[INITIAL_CAPACITY];</span><br><span class="line">         	<span class="comment">//è®¡ç®—keyåº”è¯¥å­˜æ”¾çš„ä½ç½®</span></span><br><span class="line">          <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="number">1</span>);</span><br><span class="line">          <span class="comment">//å°†Entryæ”¾åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line">          table[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(firstKey, firstValue);</span><br><span class="line">          size = <span class="number">1</span>;</span><br><span class="line">          <span class="comment">//è®¾ç½®æ•°ç»„çš„å¤§å° 16*2/3=10,ç±»ä¼¼HashMapä¸­çš„0.75*16=12</span></span><br><span class="line">          setThreshold(INITIAL_CAPACITY);</span><br><span class="line">        &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå†™æœ‰ä¸ªå¤§æ¦‚çš„å°è±¡ï¼Œåé¢å¯¹ThreadLocalMapå†…éƒ¨ç»“æ„è¿˜ä¼šè¿›è¡Œè¯¦ç»†çš„è®²è§£ï¼›</p>
<p>ä¸‹é¢æˆ‘ä»¬å†å»çœ‹ä¸€ä¸‹get()æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">      	<span class="comment">//ç”¨å½“å‰çº¿ç¨‹ä½œä¸ºkeyå»è·å–ThreadLocalMap</span></span><br><span class="line">        <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">        <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">          	<span class="comment">//mapä¸ä¸ºç©ºï¼Œç„¶åè·å–mapä¸­çš„Entry</span></span><br><span class="line">            ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">              	<span class="comment">//å¦‚æœEntryä¸ä¸ºç©ºå°±è·å–å¯¹åº”çš„valueå€¼</span></span><br><span class="line">                <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      	<span class="comment">//å¦‚æœmapä¸ºç©ºæˆ–è€…entryä¸ºç©ºçš„è¯é€šè¿‡è¯¥æ–¹æ³•åˆå§‹åŒ–ï¼Œå¹¶è¿”å›è¯¥æ–¹æ³•çš„value</span></span><br><span class="line">        <span class="keyword">return</span> setInitialValue();</span><br><span class="line">    &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>get()æ–¹æ³•å’Œset()éƒ½æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå¦‚æœmapç­‰äºç©ºçš„æ—¶å€™æˆ–è€…entryç­‰äºç©ºçš„æ—¶å€™æˆ‘ä»¬çœ‹çœ‹setInitialValue()æ–¹æ³•åšäº†ä»€ä¹ˆäº‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> T <span class="title function_">setInitialValue</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">//åˆå§‹åŒ–å˜é‡å€¼ ç”±å­ç±»å»å®ç°å¹¶åˆå§‹åŒ–å˜é‡</span></span><br><span class="line">        <span class="type">T</span> <span class="variable">value</span> <span class="operator">=</span> initialValue();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">      	<span class="comment">//è¿™é‡Œå†æ¬¡getMap();</span></span><br><span class="line">        <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">        <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">            map.set(<span class="built_in">this</span>, value);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">						<span class="comment">//å’Œset()æ–¹æ³•ä¸­çš„</span></span><br><span class="line">            createMap(t, value);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬å†å»çœ‹ä¸€ä¸‹ThreadLocalä¸­çš„initialValue()æ–¹æ³•ï¼›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">protected</span> T <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>è®¾ç½®åˆå§‹å€¼ï¼Œç”±å­ç±»å»å®ç°ï¼›å°±ä¾‹å¦‚æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­,é‡å†™ThreadLocalç±»ä¸­çš„initialValue()æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;SimpleDateFormat&gt; local = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;SimpleDateFormat&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">      	<span class="comment">//åˆå§‹åŒ–çº¿ç¨‹æœ¬åœ°å˜é‡</span></span><br><span class="line">        <span class="keyword">protected</span> SimpleDateFormat <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>createMap()æ–¹æ³•å’Œä¸Šé¢set()æ–¹æ³•ä¸­createMap()æ–¹æ³•åŒä¸€ä¸ªï¼Œå°±ä¸è¿‡å¤šçš„å™è¿°äº†ï¼›å‰©ä¸‹è¿˜æœ‰ä¸€ä¸ªremovve()æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">         <span class="type">ThreadLocalMap</span> <span class="variable">m</span> <span class="operator">=</span> getMap(Thread.currentThread());</span><br><span class="line">         <span class="keyword">if</span> (m != <span class="literal">null</span>)</span><br><span class="line">           <span class="comment">//2. ä»mapä¸­åˆ é™¤ä»¥å½“å‰threadLocalå®ä¾‹ä¸ºkeyçš„é”®å€¼å¯¹</span></span><br><span class="line">             m.remove(<span class="built_in">this</span>);</span><br><span class="line">     &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>æºç çš„è®²è§£å°±åˆ°è¿™é‡Œï¼Œä¹Ÿéƒ½æ¯”è¾ƒå¥½ç†è§£ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ThreadLocalMapçš„åº•å±‚ç»“æ„</p>
<h4 id="ThreadLocalMapçš„åº•å±‚ç»“æ„"><a href="#ThreadLocalMapçš„åº•å±‚ç»“æ„" class="headerlink" title="ThreadLocalMapçš„åº•å±‚ç»“æ„"></a>ThreadLocalMapçš„åº•å±‚ç»“æ„</h4><p>ä¸Šé¢æˆ‘ä»¬å·²ç»äº†è§£äº†ThreadLocalçš„ä½¿ç”¨åœºæ™¯ä»¥åŠå®ƒæ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ–¹æ³•ï¼›ä¸‹é¢æˆ‘ä»¬å†å»å®ƒçš„å†…éƒ¨ç»“æ„ï¼›ç»è¿‡ä¸Šçš„æºç åˆ†ææˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®å…¶å®éƒ½æ˜¯å­˜æ”¾åˆ°äº†ThreadLocalä¸­çš„å†…éƒ¨ç±»ThreadLocalMapä¸­ï¼›è€ŒThreadLocalMapä¸­åˆç»´æŠ¤äº†ä¸€ä¸ªEntryå¯¹è±¡ï¼Œä¹Ÿå°±è¯´æ•°æ®æœ€ç»ˆæ˜¯å­˜æ”¾åˆ°Entryå¯¹è±¡ä¸­çš„ï¼›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalMap</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">            <span class="comment">/** The value associated with this ThreadLocal. */</span></span><br><span class="line">            Object value;</span><br><span class="line"></span><br><span class="line">            Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">                <span class="built_in">super</span>(k);</span><br><span class="line">                value = v;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">          ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;</span><br><span class="line">            table = <span class="keyword">new</span> <span class="title class_">Entry</span>[INITIAL_CAPACITY];</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="number">1</span>);</span><br><span class="line">            table[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(firstKey, firstValue);</span><br><span class="line">            size = <span class="number">1</span>;</span><br><span class="line">            setThreshold(INITIAL_CAPACITY);</span><br><span class="line">        &#125;</span><br><span class="line">  <span class="comment">// ....................</span></span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>Entryçš„æ„é€ æ–¹æ³•æ˜¯ä»¥å½“å‰çº¿ç¨‹ä¸ºkey,å˜é‡å€¼Objectä¸ºvalueè¿›è¡Œå­˜å‚¨çš„ï¼›åœ¨ä¸Šé¢çš„æºç ä¸­ThreadLocalMapçš„æ„é€ æ–¹æ³•ä¸­ä¹Ÿæ¶‰åŠåˆ°äº†Entryï¼›çœ‹åˆ°Entryæ˜¯ä¸€ä¸ªæ•°ç»„ï¼›åˆå§‹åŒ–é•¿åº¦ä¸º<code>INITIAL_CAPACITY = 16</code>ï¼›å› ä¸º Entry ç»§æ‰¿äº† WeakReferenceï¼Œåœ¨ Entry çš„æ„é€ æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº† super(k)æ–¹æ³•å°±ä¼šå°† threadLocal å®ä¾‹åŒ…è£…æˆä¸€ä¸ª WeakRefereneceã€‚è¿™ä¹Ÿæ˜¯ThreadLocalä¼šäº§ç”Ÿå†…å­˜æ³„éœ²çš„åŸå› ï¼›</p>
<h5 id="å†…å­˜æ³„éœ²äº§ç”Ÿçš„åŸå› "><a href="#å†…å­˜æ³„éœ²äº§ç”Ÿçš„åŸå› " class="headerlink" title="å†…å­˜æ³„éœ²äº§ç”Ÿçš„åŸå› "></a>å†…å­˜æ³„éœ²äº§ç”Ÿçš„åŸå› </h5><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b3270b4983346169676645d6fb1d5f6~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20210528134958070"></p>
<p>å¦‚å›¾æ‰€ç¤ºå­˜åœ¨ä¸€æ¡å¼•ç”¨é“¾ï¼š Thread Ref-&gt;Thread-&gt;ThreadLocalMap-&gt;Entry-&gt;Key:Value,ç»è¿‡ä¸Šé¢çš„è®²è§£æˆ‘ä»¬çŸ¥é“ThreadLocalä½œä¸ºKey,ä½†æ˜¯è¢«è®¾ç½®æˆäº†å¼±å¼•ç”¨ï¼Œå¼±å¼•ç”¨åœ¨JVMåƒåœ¾å›æ”¶æ—¶æ˜¯ä¼˜å…ˆå›æ”¶çš„ï¼Œå°±æ˜¯è¯´æ— è®ºå†…å­˜æ˜¯å¦è¶³å¤Ÿå¼±å¼•ç”¨å¯¹è±¡éƒ½ä¼šè¢«å›æ”¶ï¼›å¼±å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒçŸ­ï¼›å½“å‘ç”Ÿä¸€æ¬¡GCçš„æ—¶å€™å°±ä¼šå˜æˆå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2f74dc0c0434b8793a0b522ae17896d~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20210528135713216"></p>
<p>TreadLocalMapä¸­å‡ºç°äº†Keyä¸ºnullçš„Entryï¼Œå°±æ²¡æœ‰åŠæ³•è®¿é—®è¿™äº›keyä¸ºnullçš„Entryçš„value,å¦‚æœçº¿ç¨‹è¿Ÿè¿Ÿä¸ç»“æŸï¼ˆä¹Ÿå°±æ˜¯è¯´è¿™æ¡å¼•ç”¨é“¾æ— æ„ä¹‰çš„ä¸€ç›´å­˜åœ¨ï¼‰å°±ä¼šé€ æˆvalueæ°¸è¿œæ— æ³•å›æ”¶é€ æˆå†…å­˜æ³„éœ²ï¼›å¦‚æœå½“å‰çº¿ç¨‹è¿è¡Œç»“æŸThreadï¼ŒThreadLocalMap,Entryä¹‹é—´æ²¡æœ‰äº†å¼•ç”¨é“¾ï¼Œåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™å°±ä¼šè¢«å›æ”¶ï¼›ä½†æ˜¯åœ¨å¼€å‘ä¸­æˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨çº¿ç¨‹æ± çš„æ–¹å¼ï¼Œçº¿ç¨‹æ± çš„å¤ç”¨ä¸ä¼šä¸»åŠ¨ç»“æŸï¼›æ‰€ä»¥è¿˜æ˜¯ä¼šå­˜åœ¨å†…å­˜æ³„éœ²é—®é¢˜ï¼›</p>
<p>è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨å®Œä¹‹åä¸»åŠ¨è°ƒç”¨remove()æ–¹æ³•é‡Šæ”¾æ‰ï¼›</p>
<h5 id="è§£å†³Hashå†²çª"><a href="#è§£å†³Hashå†²çª" class="headerlink" title="è§£å†³Hashå†²çª"></a>è§£å†³Hashå†²çª</h5><p>è®°å¾—åœ¨å¤§å­¦å­¦ä¹ æ•°æ®ç»“æ„çš„æ—¶å€™å­¦ä¹ äº†å¾ˆå¤šç§è§£å†³hashå†²çªçš„æ–¹æ³•;ä¾‹å¦‚ï¼š</p>
<ul>
<li><p>çº¿æ€§æ¢æµ‹æ³•ï¼ˆå¼€æ”¾åœ°å€æ³•çš„ä¸€ç§ï¼‰ï¼š è®¡ç®—å‡ºçš„æ•£åˆ—åœ°å€å¦‚æœå·²è¢«å ç”¨ï¼Œåˆ™æŒ‰é¡ºåºæ‰¾ä¸‹ä¸€ä¸ªç©ºä½ã€‚å¦‚æœæ‰¾åˆ°æœ«å°¾è¿˜æ²¡æœ‰æ‰¾åˆ°ç©ºä½ç½®å°±ä»å¤´é‡æ–°å¼€å§‹æ‰¾ï¼›</p>
</li>
<li><p>äºŒæ¬¡æ¢æµ‹æ³•ï¼ˆå¼€æ”¾åœ°å€æ³•çš„ä¸€ç§ï¼‰</p>
</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b2bdaa5d3d84514835023955341016c~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20210528171123876"></p>
<ul>
<li>é“¾åœ°å€æ³•ï¼šé“¾åœ°å€æ˜¯å¯¹æ¯ä¸€ä¸ªåŒä¹‰è¯éƒ½å»ºä¸€ä¸ªå•é“¾è¡¨æ¥è§£å†³å†²çªï¼ŒHashMapé‡‡ç”¨çš„æ˜¯è¿™ç§æ–¹æ³•ï¼›</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88eba4c11d25463798f1edab4017c444~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt="image-20210528171414508"></p>
<ul>
<li>å¤šé‡Hashæ³•ï¼šåœ¨keyå†²çªçš„æƒ…å†µä¸‹å¤šé‡hash,ç›´åˆ°ä¸å†²çªä¸ºæ­¢ï¼Œè¿™ç§æ–¹å¼ä¸æ˜“äº§ç”Ÿå †ç§¯ä½†æ˜¯è®¡ç®—é‡å¤ªå¤§ï¼›</li>
<li>å…¬å…±æº¢å‡ºåŒºæ³•ï¼Œè¿™ç§æ–¹å¼éœ€è¦ä¸¤ä¸ªè¡¨ï¼Œä¸€ä¸ªå­˜åŸºç¡€æ•°æ®ï¼Œå¦ä¸€ä¸ªå­˜æ”¾å†²çªæ•°æ®ç§°ä¸ºæº¢å‡ºè¡¨ï¼›</li>
</ul>
<p>ä¸Šé¢çš„å›¾ç‰‡éƒ½æ˜¯åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ä¸€äº›èµ„æ–™ï¼Œå’Œå¤§å­¦æ—¶å­¦ä¹ æ—¶çš„å·®ä¸å¤šæˆ‘å°±ç›´æ¥æ‹¿æ¥ç”¨äº†ï¼›ä¹Ÿå½“è‡ªå·±å¤ä¹ äº†ä¸€éï¼›</p>
<p>ä»‹ç»äº†é‚£ä¹ˆå¤šè§£å†³Hashå†²çªçš„æ–¹æ³•ï¼Œé‚£ThreadLocalMapä½¿ç”¨çš„å“ªä¸€ç§æ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(ThreadLocal&lt;?&gt; key, Object value)</span> &#123;</span><br><span class="line">            Entry[] tab = table;</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">   	   <span class="comment">//æ ¹æ®HashCode &amp; æ•°ç»„é•¿åº¦ è®¡ç®—å‡ºæ•°ç»„è¯¥å­˜æ”¾çš„ä½ç½®</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (len-<span class="number">1</span>);</span><br><span class="line">	    <span class="comment">//éå†Entryæ•°ç»„ä¸­çš„å…ƒç´ </span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> tab[i];</span><br><span class="line">                 e != <span class="literal">null</span>;</span><br><span class="line">                 e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">                ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line">	     <span class="comment">//å¦‚æœè¿™ä¸ªEntryå¯¹è±¡çš„keyæ­£å¥½æ˜¯å³å°†è®¾ç½®çš„keyï¼Œé‚£ä¹ˆå°±åˆ·æ–°Entryä¸­çš„valueï¼›</span></span><br><span class="line">                <span class="keyword">if</span> (k == key) &#123;</span><br><span class="line">                    e.value = value;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">     <span class="comment">// entry!=null,key==nullæ—¶ï¼Œè¯´æ˜threadLcoalè¿™keyå·²ç»è¢«GCäº†ï¼Œè¿™é‡Œå°±æ˜¯ä¸Šé¢è¯´åˆ°</span></span><br><span class="line">     <span class="comment">//ä¼šæœ‰å†…å­˜æ³„éœ²çš„åœ°æ–¹ï¼Œå½“ç„¶ä½œè€…ä¹ŸçŸ¥é“è¿™ç§æƒ…å†µçš„å­˜åœ¨ï¼Œæ‰€ä»¥è¿™é‡Œåšäº†ä¸€ä¸ªåˆ¤æ–­è¿›è¡Œè§£å†³è„çš„</span></span><br><span class="line">     <span class="comment">//entryï¼ˆæ•°ç»„ä¸­ä¸æƒ³å­˜æœ‰è¿‡æ—¶çš„entryï¼‰ï¼Œä½†æ˜¯ä¹Ÿä¸èƒ½è§£å†³æ³„éœ²é—®é¢˜ï¼Œå› ä¸ºæ—§valueè¿˜å­˜åœ¨æ²¡æœ‰æ¶ˆå¤±</span></span><br><span class="line">                <span class="keyword">if</span> (k == <span class="literal">null</span>) &#123;</span><br><span class="line">                  <span class="comment">//ç”¨å½“å‰æ’å…¥çš„å€¼ä»£æ›¿æ‰è¿™ä¸ªkeyä¸ºnullçš„â€œè„â€entry</span></span><br><span class="line">                    replaceStaleEntry(key, value, i);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">	   <span class="comment">//æ–°å»ºentryå¹¶æ’å…¥tableä¸­iå¤„</span></span><br><span class="line">            tab[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(key, value);</span><br><span class="line">            <span class="type">int</span> <span class="variable">sz</span> <span class="operator">=</span> ++size;</span><br><span class="line">            <span class="keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)</span><br><span class="line">                rehash();</span><br><span class="line">        &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºä½¿ç”¨çš„æ˜¯çº¿æ€§æ¢æµ‹çš„æ–¹å¼æ¥è§£å†³hashå†²çªï¼</p>
<p>æºç ä¸­é€šè¿‡<code>nextIndex(i, len)</code>æ–¹æ³•è§£å†³ hash å†²çªçš„é—®é¢˜ï¼Œè¯¥æ–¹æ³•ä¸º<code>((i + 1 &lt; len) ? i + 1 : 0);</code>ï¼Œä¹Ÿå°±æ˜¯ä¸æ–­å¾€åçº¿æ€§æ¢æµ‹ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºçš„ä½ç½®ï¼Œå½“åˆ°å“ˆå¸Œè¡¨æœ«å°¾çš„æ—¶å€™è¿˜æ²¡æœ‰æ‰¾åˆ°ç©ºä½ç½®å†ä» 0 å¼€å§‹æ‰¾ï¼Œæˆç¯å½¢ï¼</p>
<h4 id="ä½¿ç”¨ThreadLocalæ—¶å¯¹è±¡å­˜åœ¨å“ªé‡Œï¼Ÿ"><a href="#ä½¿ç”¨ThreadLocalæ—¶å¯¹è±¡å­˜åœ¨å“ªé‡Œï¼Ÿ" class="headerlink" title="ä½¿ç”¨ThreadLocalæ—¶å¯¹è±¡å­˜åœ¨å“ªé‡Œï¼Ÿ"></a>ä½¿ç”¨ThreadLocalæ—¶å¯¹è±¡å­˜åœ¨å“ªé‡Œï¼Ÿ</h4><p>åœ¨javaä¸­ï¼Œæ ˆå†…å­˜å½’å±äºå•ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå†…å­˜ï¼Œå…¶å­˜å‚¨çš„å˜é‡åªèƒ½åœ¨å…¶æ‰€å±çº¿ç¨‹ä¸­å¯è§ï¼Œå³æ ˆå†…å­˜å¯ä»¥ç†è§£æˆçº¿ç¨‹çš„ç§æœ‰å˜é‡ï¼Œè€Œå †å†…å­˜ä¸­çš„å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ï¼Œå¯ä»¥è¢«æ‰€æœ‰çº¿ç¨‹è®¿é—®ï¼é‚£ä¹ˆThreadLocalçš„å®ä¾‹ä»¥åŠå®ƒçš„å€¼æ˜¯ä¸æ˜¯å­˜æ”¾åœ¨æ ˆä¸Šå‘¢ï¼Ÿå…¶å®ä¸æ˜¯çš„ï¼Œå› ä¸ºThreadLocalçš„å®ä¾‹å®é™…ä¸Šä¹Ÿæ˜¯è¢«å…¶åˆ›å»ºçš„ç±»æŒæœ‰ï¼Œï¼ˆæ›´é¡¶ç«¯åº”è¯¥æ˜¯è¢«çº¿ç¨‹æŒæœ‰ï¼‰ï¼Œè€ŒThreadLocalçš„å€¼å…¶å®ä¹Ÿæ˜¯è¢«çº¿ç¨‹å®ä¾‹æŒæœ‰ï¼Œå®ƒä»¬éƒ½æ˜¯ä½äºå †ä¸Šï¼Œåªæ˜¯é€šè¿‡ä¸€äº›æŠ€å·§å°†å¯è§æ€§ä¿®æ”¹æˆäº†çº¿ç¨‹å¯è§ã€‚</p>
<p>ThreadLocalå°±ä»‹ç»åˆ°è¿™é‡Œï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©;åªè¦åŠªåŠ›å°±èƒ½è§£å†³çš„äº‹æƒ…å°±ä¸æ˜¯ä»€ä¹ˆéš¾äº‹;</p>
<p>ä½œè€…ï¼šèµ¤è€³å°æ°¸<br>é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/6968022754096807966">https://juejin.cn/post/6968022754096807966</a><br>æ¥æºï¼šç¨€åœŸæ˜é‡‘</p>
</div><div class="tags"><a href="/tags/java"><i class="fa fa-tag">java</i></a></div><div class="post-nav"><a class="pre" href="/posts/39137/">Spring å›¢é˜Ÿæ—¥å‰å‘å¸ƒäº† Spring Native Beta ç‰ˆ</a><a class="next" href="/posts/62113/">è®©å‰©ä½™çš„äººç”Ÿæ›´æœ‰æ„ä¹‰</a></div><div id="waline"></div><script src="//unpkg.com/@waline/client@v2/dist/waline.js"></script><link rel="stylesheet" type="text/css" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script>let metaInfo = ['nick', 'mail', 'link']
let requiredMeta = 'nick,mail'.split(',').filter(item => {
  return metaInfo.indexOf(item) > -1
})
Waline.init({
  el: '#waline',
  comment: true,
  serverURL: 'https://comment.aimak.cn',
  pageSize: '30',
  wordLimit: '500',
  requiredMeta,
})
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img src="/img/avatar.png"/></a><p>è®¤çœŸç”Ÿæ´».</p><a class="info-icon" href="https://twitter.com/fantasykaicc" title="Twitter" target="_blank" style="margin-inline:5px"> <i class="fa fa-twitter-square" style="margin-inline:5px"></i></a><a class="info-icon" href="mailto:makren@126.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/fantasykai" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AI/">AI</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/AI-%E7%BD%91%E7%BB%9C%E8%BF%90%E7%BB%B4/">AI, ç½‘ç»œè¿ç»´</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%B9%E5%99%A8/">å®¹å™¨</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">å·¥å…·</a><span class="category-list-count">36</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/">æŠ€æœ¯å°æ ˆ</a><span class="category-list-count">117</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E8%AE%B0/">æ‚è®°</a><span class="category-list-count">72</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95/">æµ‹è¯•</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AC%94%E8%AE%B0/">ç¬”è®°</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%93%E5%AD%98/">ç¼“å­˜</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">ç½‘ç»œ</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%AD%E5%BD%95/">è¯­å½•</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%91%E6%AD%A5/">è·‘æ­¥</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD-%E6%8A%80%E6%9C%AF%E8%B6%8B%E5%8A%BF-%E8%A1%8C%E4%B8%9A%E5%8A%A8%E6%80%81/" style="font-size: 15px;">äººå·¥æ™ºèƒ½, æŠ€æœ¯è¶‹åŠ¿, è¡Œä¸šåŠ¨æ€</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 15px;">äººå·¥æ™ºèƒ½</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 15px;">äººå·¥æ™ºèƒ½,</a> <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" style="font-size: 15px;">æ·±åº¦å­¦ä¹ </a> <a href="/tags/AI-%E6%99%BA%E8%83%BD%E4%BD%93/" style="font-size: 15px;">AI æ™ºèƒ½ä½“</a> <a href="/tags/Deepseek-%E8%87%AA%E6%99%BA%E7%BD%91%E7%BB%9C-%E8%BF%90%E8%90%A5%E5%95%86-%E7%BD%91%E7%BB%9C%E8%BF%90%E7%BB%B4/" style="font-size: 15px;">Deepseek, è‡ªæ™ºç½‘ç»œ, è¿è¥å•†, ç½‘ç»œè¿ç»´</a> <a href="/tags/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/" style="font-size: 15px;">çŸ¥è¯†å›¾è°±</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 15px;">æ¶æ„</a> <a href="/tags/PMO/" style="font-size: 15px;">PMO</a> <a href="/tags/%E6%8A%80%E6%9C%AF%E5%9B%A2%E9%98%9F/" style="font-size: 15px;">æŠ€æœ¯å›¢é˜Ÿ</a> <a href="/tags/%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87/" style="font-size: 15px;">å¼€å‘æ•ˆç‡</a> <a href="/tags/%E6%9D%82%E8%AE%B0/" style="font-size: 15px;">æ‚è®°</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Chrome-%E6%95%88%E7%8E%87%E6%8F%92%E4%BB%B6/" style="font-size: 15px;">Chrome æ•ˆç‡æ’ä»¶</a> <a href="/tags/idea/" style="font-size: 15px;">idea</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 15px;">è¿ç»´</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 15px;">ç¼“å­˜</a> <a href="/tags/%E6%8A%A5%E5%91%8A%E5%88%86%E4%BA%AB/" style="font-size: 15px;">æŠ¥å‘Šåˆ†äº«</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 15px;">æµ‹è¯•</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/thymeleaf/" style="font-size: 15px;">thymeleaf</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/Jenkins/" style="font-size: 15px;">Jenkins</a> <a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 15px;">å®¹å™¨</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/restful/" style="font-size: 15px;">restful</a> <a href="/tags/IPv6/" style="font-size: 15px;">IPv6</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/%E6%8A%80%E6%9C%AF%E5%B0%8F%E6%A0%88/" style="font-size: 15px;">æŠ€æœ¯å°æ ˆ</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15px;">å‰ç«¯</a> <a href="/tags/CAP/" style="font-size: 15px;">CAP</a> <a href="/tags/ideas/" style="font-size: 15px;">ideas</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 15px;">å¹¶å‘</a> <a href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/" style="font-size: 15px;">é«˜å¹¶å‘</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 15px;">æ—¥å¿—</a> <a href="/tags/%E9%A9%AC%E6%8B%89%E6%9D%BE/" style="font-size: 15px;">é©¬æ‹‰æ¾</a> <a href="/tags/%E5%81%A5%E5%BA%B7/" style="font-size: 15px;">å¥åº·</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/SDN/" style="font-size: 15px;">SDN</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">ç½‘ç»œ</a> <a href="/tags/%E8%AF%AD%E5%BD%95/" style="font-size: 15px;">è¯­å½•</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/11178/">AIé¢†åŸŸæœ€æ–°èµ„è®¯ï¼šçªç ´ã€è¶‹åŠ¿ä¸å±•æœ›</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/11177/">AIé¢†åŸŸæœ€æ–°èµ„è®¯ï¼šçªç ´ã€è¶‹åŠ¿ä¸å±•æœ›</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/11176/">AIé¢†åŸŸæœ€æ–°èµ„è®¯ï¼šçªç ´ã€è¶‹åŠ¿ä¸å±•æœ›</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/17953/">2025å¹´3æœˆ16æ—¥å—äº¬åŠç¨‹é©¬æ‹‰æ¾èµ›å‰è®­ç»ƒã€é¥®é£ŸåŠæˆç»©é¢„æµ‹</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/11175/">AIé¢†åŸŸæœ€æ–°èµ„è®¯ï¼šçªç ´ã€è¶‹åŠ¿ä¸å±•æœ›</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/11174/">AIé¢†åŸŸæœ€æ–°èµ„è®¯ï¼šçªç ´ã€è¶‹åŠ¿ä¸å±•æœ›</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/11173/">AIé¢†åŸŸæœ€æ–°èµ„è®¯ï¼šçªç ´ã€è¶‹åŠ¿ä¸å±•æœ›</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/39555/">AIé¢†åŸŸæœ€æ–°èµ„è®¯ï¼šçªç ´ã€è¶‹åŠ¿ä¸å±•æœ›</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/63210/">æ¯æ—¥èµ„è®¯</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/63209/">æ¯æ—¥èµ„è®¯</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> æœ€è¿‘è¯„è®º</i></div><div id="widget-waline-list"></div><script type="text/javascript" id="recent-comment" serverURL="https://comment.aimak.cn" count="5" src="/js/recent-comments.js?v=1.0.0" async="async"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://landscape.cncf.io/" title="CNCF" target="_blank">CNCF</a><ul></ul><a href="https://segmentfault.com/" title="SegmentFault" target="_blank">SegmentFault</a><ul></ul><a href="https://blog.csdn.net/junbaozi/category_11649936_3.html" title="CloudNative" target="_blank">CloudNative</a><ul></ul><a href="https://excalidraw.com/" title="excalidraw" target="_blank">excalidraw</a><ul></ul><a href="https://tudan.blog.csdn.net/?type=lately" title="ç‹å¦" target="_blank">ç‹å¦</a><ul></ul><a href="https://aspoem.com/zh-Hans" target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2025 <a href="/." rel="nofollow">æ«å“²'sæ–‡æ –å°ç­‘.</a><a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn/">ï½œè‹ICPå¤‡18013756å·-1</a><!--a(rel='nofollow', target='_blank', href='https://github.com/tufu9441/maupassant-hexo')  Theme--><!--|  by--><!--a(rel='nofollow', target='_blank', href='https://github.com/pagecho')  Cho.--></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸ!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>